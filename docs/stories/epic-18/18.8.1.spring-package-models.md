# Story 18.8.1: Spring Package Structure and Models

## Status
Ready for Review

## Story

**As a** developer working with Spring pattern detection,
**I want** a proper package structure and Spring-specific models,
**So that** the refactoring has a solid foundation.

## Background

This is Part 1 of splitting `spring_detector.py` (2,466 lines). Creates package structure and models.

**Reference:** CF-001 from Critical Foundation Refactoring document.

## Acceptance Criteria

1. **AC1**: `spring/` package created under `detectors/`
2. **AC2**: `SpringCandidate` model for detection candidates
3. **AC3**: `SpringRiskProfile` model for risk analysis
4. **AC4**: Package `__init__.py` with public exports
5. **AC5**: 95%+ test coverage on models

## Tasks

- [x] Create `backend/src/pattern_engine/detectors/spring/` package
- [x] Create `__init__.py` with public exports
- [x] Create `models.py` with Spring-specific data classes
- [x] Add validation logic to models
- [x] Add unit tests for models

## Dev Notes

### Files to Create

| File | Lines | Purpose |
|------|-------|---------|
| `spring/__init__.py` | ~20 | Package exports |
| `spring/models.py` | ~80 | Data models |

### Key Models

```python
@dataclass
class SpringCandidate:
    bar_index: int
    bar: OHLCV
    penetration_pct: Decimal
    recovery_pct: Decimal
    creek_level: Decimal

@dataclass
class SpringRiskProfile:
    stop_loss: Decimal
    initial_target: Decimal
    risk_reward_ratio: Decimal
```

## Story Points: 2

## Dependencies
- None

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### File List

| File | Action | Purpose |
|------|--------|---------|
| `backend/src/pattern_engine/detectors/spring/__init__.py` | Created | Package exports (SpringCandidate, SpringRiskProfile) |
| `backend/src/pattern_engine/detectors/spring/models.py` | Created | Data models with validation logic |
| `backend/tests/unit/pattern_engine/detectors/spring/__init__.py` | Created | Test package init |
| `backend/tests/unit/pattern_engine/detectors/spring/test_models.py` | Created | Unit tests (36 tests, 100% coverage) |

### Debug Log References
- None required

### Completion Notes
- Created `spring/` package under `detectors/` (AC1)
- Implemented `SpringCandidate` dataclass with validation for bar_index, penetration_pct (0-5%), recovery_pct, creek_level (AC2)
- Implemented `SpringRiskProfile` dataclass with validation for stop_loss, initial_target, risk_reward_ratio (AC3)
- Created `__init__.py` with `__all__` exports (AC4)
- Achieved 100% test coverage with 36 unit tests (AC5 - exceeds 95% requirement)
- All linting (ruff) and type checking (mypy) passes

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-14 | 1.0 | Story created | Bob (Scrum Master) |
| 2026-01-15 | 1.1 | Implementation complete | James (Dev Agent) |
