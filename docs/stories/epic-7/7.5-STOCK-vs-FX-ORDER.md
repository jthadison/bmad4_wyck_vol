# Story 7.5 (Stocks) vs 7.5-FX (Forex): Development Order

**Created:** 2025-11-18
**Question:** Does it matter which correlation story we implement first?

---

## Answer: NO, development order does NOT matter between these two stories

**You can develop them in ANY order, or even in PARALLEL.**

---

## Why They're Independent

### **Different Asset Classes:**

| Story 7.5 (Stocks) | Story 7.5-FX (Forex) |
|-------------------|---------------------|
| Stock sector correlation | Currency exposure correlation |
| AAPL + MSFT + GOOGL = "Technology" | EUR/USD + EUR/GBP = "EUR exposure" |
| 10% max per sector | 6% max per currency (phase-weighted) |
| Sector mapping (YAML config) | Currency pair parsing (EUR/USD → EUR, USD) |
| Statistical correlation | Mechanical correlation |

### **Different Data Models:**

**Story 7.5 (Stocks):**
```python
# Stock-specific
class SectorMapping(BaseModel):
    symbol: str  # "AAPL"
    sector: str  # "Technology"
    asset_class: str  # "stock"
    geography: str  # "US"

class CorrelatedRisk(BaseModel):
    correlation_type: str  # "sector"
    correlation_key: str  # "Technology"
    total_risk: Decimal
    # ...
```

**Story 7.5-FX (Forex):**
```python
# Forex-specific
class ForexCurrencyExposure(BaseModel):
    currency_exposure_raw: dict[str, Decimal]  # {"EUR": 4.0, "USD": -6.0}
    currency_exposure_weighted: dict[str, Decimal]  # Phase-weighted
    phase_breakdown: dict[str, dict[str, Decimal]]
    active_campaigns: list[str]
    # ...
```

### **Different Modules:**

**Story 7.5 (Stocks):**
- File: `backend/src/risk_management/correlation.py`
- Functions: `calculate_correlated_risk()`, `validate_correlated_risk()`
- Config: `backend/config/sector_mappings.yaml`
- Models: `backend/src/models/risk.py` (SectorMapping, CorrelatedRisk)

**Story 7.5-FX (Forex):**
- File: `backend/src/risk_management/forex_correlation_tracker.py`
- Functions: `calculate_currency_exposure()`, `validate_currency_limit()`
- Models: `backend/src/risk_management/forex_correlation_tracker.py` (ForexCurrencyExposure)
- NO config file (currency parsing is algorithmic)

### **Zero Code Overlap:**

```
Story 7.5 (Stocks):
backend/src/risk_management/correlation.py          ← Stock correlation logic
backend/src/models/risk.py                           ← Stock models
backend/config/sector_mappings.yaml                  ← Stock sector config
backend/tests/unit/risk_management/test_correlation.py

Story 7.5-FX (Forex):
backend/src/risk_management/forex_correlation_tracker.py  ← Forex correlation logic
backend/tests/unit/risk_management/test_forex_correlation_tracker.py

NO SHARED FILES (except base Position model from earlier stories)
```

---

## Shared Dependencies (Both Stories)

Both stories depend on the **SAME earlier stories**, but not on each other:

### **Common Dependencies:**

```
Story 7.2 (Stock Position Sizing) ──┐
Story 7.2-FX (Forex Position Sizing) ─┤
                                       ├──> Position data model
Story 7.3 (Stock Portfolio Heat) ─────┤
Story 7.3-FX (Forex Portfolio Heat) ──┘

    ↓                           ↓
Story 7.5 (Stock)         Story 7.5-FX (Forex)
    ↓                           ↓
  INDEPENDENT               INDEPENDENT
```

**Both need:**
- ✅ Position model (`position_risk_pct`, `symbol`, `status`)
- ✅ `get_open_positions()` repository function
- ✅ Decimal-based risk calculations
- ✅ Portfolio heat infrastructure

**Neither needs the other.**

---

## Development Order Options

### **Option 1: Stocks First, Then Forex**

```
Week 1: Story 7.5 (Stocks) - 8 story points
    ↓
Week 2: Story 7.5-FX (Forex) - 6 story points (after Wyckoff revisions)
```

**Advantages:**
- ✅ Simpler story first (stocks use static sector mapping, no phase weighting)
- ✅ Learn correlation patterns, apply to forex
- ✅ Stock correlation is more straightforward (no Wyckoff phase complexity)

**Disadvantages:**
- ❌ Forex traders wait longer for currency limits
- ❌ Stock correlation less critical than forex (10% sector vs 6% currency)

---

### **Option 2: Forex First, Then Stocks**

```
Week 1: Story 7.5-FX (Forex) - 6 story points (after Wyckoff revisions)
    ↓
Week 2: Story 7.5 (Stocks) - 8 story points
```

**Advantages:**
- ✅ Forex currency limits more critical (tighter limits, mechanical exposure)
- ✅ Forex correlation is Wyckoff-aligned (phase-weighted exposure)
- ✅ Story 7.5-FX is already revised and approved by Wyckoff team

**Disadvantages:**
- ❌ More complex story first (phase weighting, campaign counting)
- ❌ Requires Story 7.4-FX to be complete (phase data dependency)

---

### **Option 3: Parallel Development**

```
Developer A: Story 7.5 (Stocks)
Developer B: Story 7.5-FX (Forex)

Both complete Week 1-2, merge independently
```

**Advantages:**
- ✅ Fastest completion (both done in ~2 weeks)
- ✅ No blocking dependencies between stories
- ✅ Independent testing and review

**Disadvantages:**
- ❌ Requires two developers
- ❌ Cannot learn from first implementation
- ❌ Potential for divergent patterns (need coordination)

---

## Recommendation from Wyckoff Team

### **Richard (Wyckoff Mentor):**

> "From a Wyckoff methodology perspective, **Story 7.5-FX is more important** than Story 7.5 (stocks). Forex currency exposure is MECHANICAL (EUR/USD + EUR/GBP both mechanically buy EUR), while stock sector correlation is STATISTICAL (AAPL and MSFT don't mechanically correlate). The forex currency limits prevent real portfolio blow-up scenarios (USD crash), while stock sector limits are portfolio hygiene. **Prioritize 7.5-FX if you must choose.**"

### **Victoria (Volume Specialist):**

> "Stock sector correlation is loose - AAPL and MSFT can diverge despite both being Technology. Forex currency correlation is ABSOLUTE - every EUR/USD position is long EUR, period. The mechanical nature of forex exposure makes 7.5-FX more critical. But the two stories don't interact, so develop whichever is higher business priority."

### **Rachel (Risk Manager):**

> "From pure risk management: **forex currency limits (6%) are tighter than stock sector limits (10%)** for good reason. Currency exposure is more concentrated and dangerous. If I had to choose one, I'd implement 7.5-FX first to protect against currency concentration risk. But they're independent - no technical reason you can't do both in parallel."

---

## Current Project Status

### **Story 7.5 (Stocks):**
- **Status:** Draft
- **Dependencies:** Story 7.2 ✅, Story 7.3 ✅ (both complete)
- **Ready to develop:** ✅ YES (no blockers)
- **Estimate:** 8 story points
- **Wyckoff review:** Not yet reviewed (may not need it - simpler stock logic)

### **Story 7.5-FX (Forex):**
- **Status:** Ready for Development (NEEDS REVISION per Wyckoff review)
- **Dependencies:** Story 7.2-FX ✅, Story 7.3-FX ✅, Story 7.4-FX ⚠️ (needs merge)
- **Ready to develop:** ⚠️ AFTER Story 7.4-FX merged (phase data required)
- **Estimate:** 6 story points (revised from 8)
- **Wyckoff review:** ✅ COMPLETE (revisions documented in 7.5-FX.WYCKOFF-REVIEW-UPDATES.md)

---

## Decision Matrix

| Factor | Story 7.5 (Stocks) | Story 7.5-FX (Forex) |
|--------|-------------------|---------------------|
| **Business Priority** | Medium (portfolio hygiene) | High (prevent blow-ups) |
| **Dependencies Met** | ✅ YES (7.2, 7.3 complete) | ⚠️ NO (7.4-FX needs merge) |
| **Complexity** | Lower (static sector mapping) | Higher (phase weighting, campaigns) |
| **Story Points** | 8 points | 6 points |
| **Risk Severity** | Medium (10% sector limit) | High (6% currency limit) |
| **Wyckoff Review** | Not required | ✅ Complete (needs doc updates) |
| **Current Blocker** | None | Story 7.4-FX merge |

---

## Practical Recommendation

### **Scenario 1: Story 7.4-FX Already Merged**

**Recommended Order: Story 7.5-FX → Story 7.5 (Stocks)**

**Reasoning:**
- Higher business priority (forex risk > stock sector risk)
- Wyckoff-reviewed and approved
- Lower story points (6 vs 8) - faster completion
- More critical for forex traders

### **Scenario 2: Story 7.4-FX Still on Branch (Current State)**

**Recommended Order: Story 7.5 (Stocks) → Story 7.5-FX**

**Reasoning:**
- Story 7.5 (stocks) has no blockers - can start immediately
- Story 7.5-FX blocked until 7.4-FX merge (phase data dependency)
- Use time waiting for 7.4-FX merge to complete stock correlation
- Then switch to 7.5-FX when 7.4-FX ready

**Timeline:**
```
Day 1-3: Complete/merge Story 7.4-FX (current branch)
Day 1-8: Develop Story 7.5 (Stocks) in parallel (8 points)
Day 9-10: Apply Wyckoff revisions to Story 7.5-FX doc
Day 11-16: Develop Story 7.5-FX (Forex) (6 points)

Total: ~16 days for both stories
```

### **Scenario 3: Two Developers Available**

**Recommended: Parallel Development**

**Developer A:**
- Story 7.5 (Stocks)
- No blockers, can start immediately
- 8 story points

**Developer B:**
- Wait for Story 7.4-FX merge (1-2 days)
- Apply Wyckoff revisions to 7.5-FX doc (0.5 days)
- Story 7.5-FX (Forex) (6 points)

**Timeline:**
```
Week 1: Both stories in development
Week 2: Both stories complete and merged

Total: ~10 days for both stories
```

---

## Key Insight

**The two stories are ASSET-CLASS SPECIFIC and completely independent:**

- **Story 7.5:** Stock sector correlation (AAPL + MSFT + GOOGL = Technology sector)
- **Story 7.5-FX:** Forex currency correlation (EUR/USD + EUR/GBP = EUR exposure)

**No shared code, no shared data, no dependencies between them.**

**The ONLY constraint is:**
- Story 7.5 needs Stock stories 7.2, 7.3 complete ✅
- Story 7.5-FX needs Forex stories 7.2-FX, 7.3-FX, 7.4-FX complete ⚠️

**Both stock foundation stories are complete.**
**Forex 7.4-FX is on branch (needs merge).**

---

## Answer Summary

**Q: Does it matter which order we develop Story 7.5 (stocks) vs Story 7.5-FX (forex)?**

**A: NO - they are independent and can be developed in any order or in parallel.**

**Recommended order based on current blockers:**
1. **First:** Story 7.5 (Stocks) - no blockers, can start today
2. **While waiting:** Merge Story 7.4-FX to main
3. **Second:** Story 7.5-FX (Forex) - after 7.4-FX merged

**Or if 7.4-FX is already merged:**
1. **First:** Story 7.5-FX (Forex) - higher priority, Wyckoff-approved
2. **Second:** Story 7.5 (Stocks) - lower priority

**The stories do NOT depend on each other - only on their respective asset-class foundations.**

---

**Document Status:** Ready for Bob (Scrum Master) review
**Recommendation:** Choose order based on Story 7.4-FX merge status and developer availability
