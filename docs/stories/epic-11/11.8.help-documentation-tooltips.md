# Story 11.8: Help Documentation & Tooltips

## Status
Done

## Story
**As a** trader,
**I want** contextual help and tooltips explaining system features,
**so that** I can learn to use the system without external documentation.

## Acceptance Criteria
1. Tooltips: hover over icons/metrics to see explanations
2. Help icons: "?" icon next to complex features opens help dialog
3. Glossary: searchable glossary of Wyckoff terms (Spring, Ice, Creek, SOS, etc.)
4. Tutorials: step-by-step walkthroughs for common tasks (reviewing signals, adjusting config)
5. FAQ page: answers to common questions
6. Keyboard shortcuts: "Press ? to see shortcuts" overlay
7. Component: `HelpCenter.tsx`
8. Content: stored in Markdown files, rendered to HTML
9. Search: full-text search across all help content
10. Feedback: "Was this helpful?" thumbs up/down on each article

## Tasks / Subtasks

- [ ] **Task 1: Backend - Help Content Data Models** (AC: 3, 5, 8)
  - [ ] Subtask 1.1: Create `HelpArticle` Pydantic model in `backend/src/models/help.py`
  - [ ] Subtask 1.2: Fields: id, slug, title, content (Markdown), category (GLOSSARY, FAQ, TUTORIAL), tags, keywords, last_updated, view_count
  - [ ] Subtask 1.3: Create `GlossaryTerm` Pydantic model with fields: term, short_definition, full_description, related_terms, wyckoff_phase
  - [ ] Subtask 1.4: Create `Tutorial` Pydantic model with fields: id, title, description, steps (JSON array), difficulty (BEGINNER, INTERMEDIATE, ADVANCED), estimated_time_minutes
  - [ ] Subtask 1.5: Create `KeyboardShortcut` Pydantic model with fields: key_combination, action_description, context (GLOBAL, CHART, SIGNALS)
  - [ ] Subtask 1.6: Create `HelpFeedback` Pydantic model with fields: article_id, helpful (boolean), user_comment (optional), created_at
  - [ ] Subtask 1.7: Unit test models with Pydantic validation (pytest)

- [ ] **Task 2: Backend - Help Content Repository** (AC: 8, 9)
  - [ ] Subtask 2.1: Create `backend/src/help/content/` directory for Markdown files
  - [ ] Subtask 2.2: Subdirectories: `glossary/`, `faq/`, `tutorials/`, `shortcuts/`
  - [ ] Subtask 2.3: Create `HelpContentLoader` in `backend/src/help/content_loader.py`
  - [ ] Subtask 2.4: Implement `load_markdown_files()` to scan content directory and parse frontmatter (YAML metadata at top of .md files)
  - [ ] Subtask 2.5: Use `python-frontmatter` library to extract metadata and Markdown content
  - [ ] Subtask 2.6: Implement `parse_glossary()` to load glossary terms from `glossary/*.md`
  - [ ] Subtask 2.7: Implement `parse_faq()` to load FAQ articles from `faq/*.md`
  - [ ] Subtask 2.8: Implement `parse_tutorials()` to load tutorial content from `tutorials/*.md`
  - [ ] Subtask 2.9: Implement content caching strategy (reload only on file change)
  - [ ] Subtask 2.10: Unit test content loading with sample Markdown files (pytest)

- [ ] **Task 3: Backend - Markdown Rendering** (AC: 8)
  - [ ] Subtask 3.1: Create `MarkdownRenderer` in `backend/src/help/markdown_renderer.py`
  - [ ] Subtask 3.2: Use `markdown-it-py` library for Markdown to HTML conversion
  - [ ] Subtask 3.3: Enable plugins: tables, code syntax highlighting, task lists
  - [ ] Subtask 3.4: Implement sanitization to prevent XSS (use `bleach` library)
  - [ ] Subtask 3.5: Add custom renderer for Wyckoff term links: `[[Spring]]` â†’ link to glossary entry
  - [ ] Subtask 3.6: Implement code block syntax highlighting with `pygments`
  - [ ] Subtask 3.7: Generate table of contents from headers for long articles
  - [ ] Subtask 3.8: Unit test Markdown rendering with various content types (pytest)

- [ ] **Task 4: Backend - Full-Text Search** (AC: 9)
  - [ ] Subtask 4.1: Create `help_articles` table in database with fields: id, slug, title, content_text (for search), content_html, category, tags, keywords, last_updated
  - [ ] Subtask 4.2: Create PostgreSQL full-text search index using `tsvector`: `CREATE INDEX idx_help_articles_search ON help_articles USING GIN(to_tsvector('english', title || ' ' || content_text || ' ' || keywords));`
  - [ ] Subtask 4.3: Create Alembic migration for help_articles table and search index
  - [ ] Subtask 4.4: Create `HelpRepository` in `backend/src/repositories/help_repository.py`
  - [ ] Subtask 4.5: Implement `search_articles(query)` using PostgreSQL full-text search with ranking
  - [ ] Subtask 4.6: Implement query highlighting: return snippets with search terms highlighted
  - [ ] Subtask 4.7: Implement autocomplete suggestions based on glossary terms and article titles
  - [ ] Subtask 4.8: Unit test search with various queries (pytest)

- [ ] **Task 5: Backend - Help Content Seeding** (AC: 3, 5, 6)
  - [ ] Subtask 5.1: Create initial glossary content in `backend/src/help/content/glossary/`
  - [ ] Subtask 5.2: Write core pattern glossary entries: Spring.md, UTAD.md, SOS.md, LPS.md, Creek.md, Ice.md, Jump.md
  - [ ] Subtask 5.3: **[WYCKOFF]** Write preliminary events glossary: PS.md (Preliminary Support), SC.md (Selling Climax), AR.md (Automatic Rally), ST.md (Secondary Test)
  - [ ] Subtask 5.4: **[WYCKOFF]** Write distribution pattern glossary: SOW.md (Sign of Weakness), LPSY.md (Last Point of Supply), Backup.md (BU)
  - [ ] Subtask 5.5: **[WYCKOFF]** Write Wyckoff concepts glossary: Composite-Operator.md, Effort-vs-Result.md, Cause-and-Effect.md, Supply-and-Demand.md
  - [ ] Subtask 5.6: **[WYCKOFF]** Write schematics glossary: Accumulation-Schematic-1.md, Accumulation-Schematic-2.md, Distribution-Schematic-1.md, Distribution-Schematic-2.md
  - [ ] Subtask 5.7: **[WYCKOFF]** Write VSA glossary: No-Demand.md, No-Supply.md, Stopping-Volume.md, Climactic-Volume.md, Ultra-High-Volume.md, High-Volume.md, Low-Volume.md, Up-Thrust.md
  - [ ] Subtask 5.8: **[WYCKOFF]** Write phase glossary entries: Phase-A.md (Stopping the prior trend), Phase-B.md (Building the cause), Phase-C.md (The test), Phase-D.md (Trend emergence), Phase-E.md (Trend confirmation)
  - [ ] Subtask 5.9: **[WYCKOFF]** Write range structure glossary: Trading-Range.md, Trend.md, Support.md, Resistance.md
  - [ ] Subtask 5.10: Write glossary entry for signal confidence: Signal-Confidence.md (Explain 120-point scoring system, volume/penetration/recovery components)
  - [ ] Subtask 5.11: Create FAQ content in `backend/src/help/content/faq/`
  - [ ] Subtask 5.12: Write FAQ articles: What-is-Wyckoff.md, How-are-signals-generated.md, How-is-risk-calculated.md, What-is-portfolio-heat.md, How-do-campaigns-work.md
  - [ ] Subtask 5.13: **[WYCKOFF]** Write Wyckoff FAQ: What-is-Composite-Operator.md, How-to-read-Wyckoff-schematics.md, Difference-between-Spring-and-Shakeout.md
  - [ ] Subtask 5.14: Create tutorial content in `backend/src/help/content/tutorials/`
  - [ ] Subtask 5.15: Write tutorials: Reviewing-Your-First-Signal.md, Adjusting-Configuration.md, Understanding-Pattern-Confidence.md, Managing-Risk-Limits.md
  - [ ] Subtask 5.16: **[WYCKOFF]** Write Wyckoff tutorials: Reading-Wyckoff-Charts.md, Identifying-Accumulation-Phases.md, Understanding-Cause-Building.md, Phase-Progression.md
  - [ ] Subtask 5.17: **[WYCKOFF]** Write pattern recognition tutorials: Identifying-Springs.md, Identifying-UTAD.md, Identifying-SOS-Signals.md, Identifying-LPS-Entries.md
  - [ ] Subtask 5.18: **[RISK]** Write risk management tutorials: Structural-Stop-Placement.md, Position-Sizing.md, Three-Phase-Position-Building.md
  - [ ] Subtask 5.19: Create keyboard shortcuts reference in `backend/src/help/content/shortcuts.md`
  - [ ] Subtask 5.20: Document shortcuts: ? (show help), Esc (close dialogs), / (focus search), Ctrl+K (command palette), Arrow keys (navigate charts)
  - [ ] Subtask 5.21: Create migration script to seed help_articles table from Markdown files
  - [ ] Subtask 5.22: Verify seeded content with manual testing

- [ ] **Task 6: Backend - Help API Endpoints** (AC: 3, 5, 9, 10)
  - [ ] Subtask 6.1: Create `GET /api/v1/help/articles` route in `backend/src/api/routes/help.py`
  - [ ] Subtask 6.2: Query parameters: category (GLOSSARY, FAQ, TUTORIAL, ALL), limit, offset
  - [ ] Subtask 6.3: Return paginated list of articles with metadata (no full content, only title/description)
  - [ ] Subtask 6.4: Create `GET /api/v1/help/articles/{slug}` route to get full article with rendered HTML
  - [ ] Subtask 6.5: Increment view_count when article is retrieved
  - [ ] Subtask 6.6: Create `GET /api/v1/help/search` route for full-text search
  - [ ] Subtask 6.7: Query parameter: q (search query), return ranked results with highlighted snippets
  - [ ] Subtask 6.8: Create `GET /api/v1/help/glossary` route to get all glossary terms
  - [ ] Subtask 6.9: Support filtering by wyckoff_phase or alphabetical listing
  - [ ] Subtask 6.10: Create `POST /api/v1/help/feedback` route to submit article feedback
  - [ ] Subtask 6.11: Validate feedback input and store in database
  - [ ] Subtask 6.12: Unit test endpoints with mock service layer (pytest)
  - [ ] Subtask 6.13: Integration test with database (pytest)

- [ ] **Task 7: Backend - Type Generation** (AC: 7)
  - [ ] Subtask 7.1: Run `pydantic-to-typescript` to generate TypeScript types
  - [ ] Subtask 7.2: Verify generated types in `frontend/src/types/`: HelpArticle.ts, GlossaryTerm.ts, Tutorial.ts, KeyboardShortcut.ts, HelpFeedback.ts
  - [ ] Subtask 7.3: Update FastAPI OpenAPI schema with help endpoints

- [ ] **Task 8: Frontend - Help Store** (AC: 3, 5, 9)
  - [ ] Subtask 8.1: Create Pinia store `useHelpStore.ts` in `frontend/src/stores/`
  - [ ] Subtask 8.2: Define store state: articles (HelpArticle[]), glossaryTerms (GlossaryTerm[]), searchResults, currentArticle, isLoading, error
  - [ ] Subtask 8.3: Define store actions: fetchArticles(category), fetchArticle(slug), searchHelp(query), fetchGlossary(), submitFeedback(articleId, helpful, comment)
  - [ ] Subtask 8.4: Define store getters: getArticleBySlug, getTermByName, articlesGroupedByCategory
  - [ ] Subtask 8.5: Implement caching: cache articles and glossary for 24 hours
  - [ ] Subtask 8.6: Unit test store with mock API responses (Vitest)

- [ ] **Task 9: Frontend - Tooltip Component** (AC: 1)
  - [ ] Subtask 9.1: Use PrimeVue Tooltip directive for hover tooltips
  - [ ] Subtask 9.2: Create tooltip composable `useTooltip.ts` in `frontend/src/composables/`
  - [ ] Subtask 9.3: Implement `registerTooltips()` to attach tooltips to elements with `data-tooltip` attribute
  - [ ] Subtask 9.4: Define tooltip content for common metrics: Win Rate, R-Multiple, Portfolio Heat, Confidence Score, Creek/Ice/Jump
  - [ ] Subtask 9.5: Create `TooltipContent.vue` component for rich HTML tooltips with formatting
  - [ ] Subtask 9.6: Support dynamic tooltip loading from glossary for Wyckoff terms
  - [ ] Subtask 9.7: Configure tooltip appearance: delay (300ms), position (auto), dark theme
  - [ ] Subtask 9.8: Component test for tooltip rendering (Vitest)

- [ ] **Task 10: Frontend - Help Icon Component** (AC: 2)
  - [ ] Subtask 10.1: Create `HelpIcon.vue` component in `frontend/src/components/help/`
  - [ ] Subtask 10.2: Props: `articleSlug` (string, required), `tooltipText` (string, optional), `placement` (string, default: "right")
  - [ ] Subtask 10.3: Render "?" icon button using PrimeVue Button with icon style
  - [ ] Subtask 10.4: On click, open help dialog with article content
  - [ ] Subtask 10.5: Use PrimeVue Dialog component for help modal
  - [ ] Subtask 10.6: Dialog shows article title, rendered HTML content, related articles
  - [ ] Subtask 10.7: Include feedback buttons at bottom: "Was this helpful? ðŸ‘ ðŸ‘Ž"
  - [ ] Subtask 10.8: Component test for help icon interaction (Vitest)

- [ ] **Task 11: Frontend - Glossary Component** (AC: 3)
  - [ ] Subtask 11.1: Create `GlossaryView.vue` component in `frontend/src/components/help/`
  - [ ] Subtask 11.2: Display glossary terms in alphabetical list using PrimeVue DataView or custom list
  - [ ] Subtask 11.3: Filter by Wyckoff phase using dropdown: All, Phase A, Phase B, Phase C, Phase D, Phase E
  - [ ] Subtask 11.4: Search filter: real-time filter as user types in search box
  - [ ] Subtask 11.5: Term card layout: term name, short definition, "Read more" link
  - [ ] Subtask 11.6: Click term to expand full description with related terms
  - [ ] Subtask 11.7: Related terms are clickable links to navigate to other glossary entries
  - [ ] Subtask 11.8: Empty state: "No terms found matching your search"
  - [ ] Subtask 11.9: Component test for glossary rendering and filtering (Vitest)

- [ ] **Task 12: Frontend - FAQ Component** (AC: 5)
  - [ ] Subtask 12.1: Create `FAQView.vue` component in `frontend/src/components/help/`
  - [ ] Subtask 12.2: Display FAQ articles using PrimeVue Accordion component
  - [ ] Subtask 12.3: Each accordion item shows question as header, answer as content
  - [ ] Subtask 12.4: Render answer HTML from Markdown with safe HTML rendering
  - [ ] Subtask 12.5: Add search box at top to filter FAQ questions in real-time
  - [ ] Subtask 12.6: Include feedback buttons on each FAQ item
  - [ ] Subtask 12.7: Related articles section at bottom of each FAQ
  - [ ] Subtask 12.8: Component test for FAQ accordion (Vitest)

- [ ] **Task 13: Frontend - Tutorial Component** (AC: 4)
  - [ ] Subtask 13.1: Create `TutorialView.vue` component in `frontend/src/components/help/`
  - [ ] Subtask 13.2: Display tutorial list with cards: title, description, difficulty badge, estimated time
  - [ ] Subtask 13.3: Filter by difficulty: All, Beginner, Intermediate, Advanced
  - [ ] Subtask 13.4: Click tutorial card to open step-by-step walkthrough
  - [ ] Subtask 13.5: Create `TutorialWalkthrough.vue` component for interactive tutorials
  - [ ] Subtask 13.6: Display steps with progress indicator: "Step 2 of 5"
  - [ ] Subtask 13.7: Navigation buttons: Previous, Next, Exit Tutorial
  - [ ] Subtask 13.8: Each step shows content (text, images, code snippets) with instructions
  - [ ] Subtask 13.9: Optional interactive elements: highlight UI components, show tooltips
  - [ ] Subtask 13.10: Completion screen: "Tutorial completed! ðŸŽ‰" with feedback prompt
  - [ ] Subtask 13.11: Component test for tutorial navigation (Vitest)

- [ ] **Task 14: Frontend - Keyboard Shortcuts Overlay** (AC: 6)
  - [ ] Subtask 14.1: Create `KeyboardShortcutsOverlay.vue` component in `frontend/src/components/help/`
  - [ ] Subtask 14.2: Display overlay when user presses "?" key
  - [ ] Subtask 14.3: Use PrimeVue Dialog or OverlayPanel for modal display
  - [ ] Subtask 14.4: Layout shortcuts in table format: Key Combination | Action | Context
  - [ ] Subtask 14.5: Group shortcuts by context: Global, Chart View, Signal Dashboard, Settings
  - [ ] Subtask 14.6: Visual key representation: render keys as buttons (e.g., Ctrl + K)
  - [ ] Subtask 14.7: Close overlay on Esc key or click outside
  - [ ] Subtask 14.8: Create global keyboard listener composable `useKeyboardShortcuts.ts`
  - [ ] Subtask 14.9: Register global shortcuts: ? (help), / (search focus), Esc (close)
  - [ ] Subtask 14.10: Component test for keyboard overlay (Vitest)

- [ ] **Task 15: Frontend - HelpCenter Component** (AC: 7, 9)
  - [ ] Subtask 15.1: Create `HelpCenter.vue` component in `frontend/src/components/help/` (note: Epic references .tsx but project uses Vue)
  - [ ] Subtask 15.2: Layout: sidebar with navigation, main content area
  - [ ] Subtask 15.3: Sidebar sections: Glossary, FAQ, Tutorials, Keyboard Shortcuts
  - [ ] Subtask 15.4: Search bar at top of help center using PrimeVue InputText with icon
  - [ ] Subtask 15.5: Implement full-text search with autocomplete suggestions
  - [ ] Subtask 15.6: Search results page: ranked results with highlighted query terms
  - [ ] Subtask 15.7: Click result to navigate to full article
  - [ ] Subtask 15.8: Breadcrumb navigation: Home > Category > Article
  - [ ] Subtask 15.9: Table of contents for long articles (auto-generated from headers)
  - [ ] Subtask 15.10: Component test for help center navigation (Vitest)

- [ ] **Task 16: Frontend - Help Context Integration** (AC: 2)
  - [ ] Subtask 16.1: Identify complex features that need help icons
  - [ ] Subtask 16.2: Add HelpIcon components throughout UI: Configuration Wizard, Pattern Performance Dashboard, Risk Management Settings, Notification Preferences
  - [ ] Subtask 16.3: Map each help icon to relevant article slug
  - [ ] Subtask 16.4: Add tooltips to metrics throughout UI using tooltip directive
  - [ ] Subtask 16.5: Create tooltip content map in `frontend/src/config/tooltips.ts`
  - [ ] Subtask 16.6: Ensure consistent tooltip styling across application

- [ ] **Task 17: Frontend - Search Integration** (AC: 9)
  - [ ] Subtask 17.1: Create global search composable `useGlobalSearch.ts`
  - [ ] Subtask 17.2: Implement search API integration with debouncing (300ms)
  - [ ] Subtask 17.3: Display search results with categories: Glossary, FAQ, Tutorials
  - [ ] Subtask 17.4: Highlight matching query terms in results
  - [ ] Subtask 17.5: Show "No results found" with suggestions for alternative searches
  - [ ] Subtask 17.6: Add keyboard navigation: Arrow keys to navigate results, Enter to open
  - [ ] Subtask 17.7: Track search analytics: popular queries, zero-result queries
  - [ ] Subtask 17.8: Component test for search functionality (Vitest)

- [ ] **Task 18: Frontend - Feedback System** (AC: 10)
  - [ ] Subtask 18.1: Create `ArticleFeedback.vue` component for thumbs up/down buttons
  - [ ] Subtask 18.2: Display feedback buttons at bottom of each article
  - [ ] Subtask 18.3: On thumbs up/down click, submit feedback via API
  - [ ] Subtask 18.4: Show thank you message: "Thanks for your feedback!"
  - [ ] Subtask 18.5: Optional comment textarea appears on thumbs down: "How can we improve?"
  - [ ] Subtask 18.6: Prevent duplicate feedback: disable buttons after submission
  - [ ] Subtask 18.7: Store feedback state in localStorage to persist across sessions
  - [ ] Subtask 18.8: Component test for feedback interaction (Vitest)

- [ ] **Task 19: Frontend - Markdown Content Rendering** (AC: 8)
  - [ ] Subtask 19.1: Install `marked` or `markdown-it` library for Markdown rendering: `npm install marked`
  - [ ] Subtask 19.2: Create `MarkdownRenderer.vue` component in `frontend/src/components/help/`
  - [ ] Subtask 19.3: Props: `content` (string, Markdown), `sanitize` (boolean, default: true)
  - [ ] Subtask 19.4: Render Markdown to HTML using library
  - [ ] Subtask 19.5: Sanitize HTML with DOMPurify to prevent XSS
  - [ ] Subtask 19.6: Apply custom styling to rendered HTML: code blocks, tables, lists
  - [ ] Subtask 19.7: Enable syntax highlighting for code blocks using highlight.js
  - [ ] Subtask 19.8: Support custom Markdown extensions: glossary term links `[[Spring]]` â†’ link to glossary
  - [ ] Subtask 19.9: Component test for Markdown rendering (Vitest)

- [ ] **Task 20: Frontend - Help Center Routing** (AC: 7)
  - [ ] Subtask 20.1: Add help routes to Vue Router in `frontend/src/router/index.ts`
  - [ ] Subtask 20.2: Routes: `/help` (home), `/help/glossary`, `/help/faq`, `/help/tutorials`, `/help/tutorials/:slug`, `/help/article/:slug`, `/help/search`
  - [ ] Subtask 20.3: Lazy load help components using dynamic imports for performance
  - [ ] Subtask 20.4: Add "Help" link to main navigation menu
  - [ ] Subtask 20.5: Support deep linking: share URLs to specific articles
  - [ ] Subtask 20.6: Implement 404 handling for missing articles: redirect to help home with message
  - [ ] Subtask 20.7: Navigation test with Vue Router (Vitest)

- [ ] **Task 21: Integration Testing** (AC: All)
  - [ ] Subtask 21.1: E2E test: Open help center from main navigation (Playwright)
  - [ ] Subtask 21.2: E2E test: Search for "Spring" â†’ verify glossary result appears (Playwright)
  - [ ] Subtask 21.3: E2E test: Click glossary term â†’ verify full definition displays (Playwright)
  - [ ] Subtask 21.4: E2E test: Hover over metric â†’ verify tooltip appears (Playwright)
  - [ ] Subtask 21.5: E2E test: Click help icon next to feature â†’ verify dialog opens with article (Playwright)
  - [ ] Subtask 21.6: E2E test: Navigate to FAQ â†’ expand accordion item â†’ verify answer displays (Playwright)
  - [ ] Subtask 21.7: E2E test: Start tutorial â†’ navigate through steps â†’ verify completion (Playwright)
  - [ ] Subtask 21.8: E2E test: Press "?" key â†’ verify keyboard shortcuts overlay appears (Playwright)
  - [ ] Subtask 21.9: E2E test: Submit article feedback â†’ verify success message (Playwright)
  - [ ] Subtask 21.10: E2E test: Search with no results â†’ verify empty state message (Playwright)

## Dev Notes

### Previous Story Insights
Story 11.7 (User Settings & Preferences) established patterns for settings persistence and user preferences management. Story 11.8 extends the user experience by providing comprehensive in-app documentation and contextual help, ensuring traders can learn the system without leaving the application.

### Epic Context
This story is part of Epic 11 (Configuration & Analytics) which delivers FR29 and FR30 UI components. Story 11.8 implements the help documentation and tooltip system that enables traders to understand complex Wyckoff concepts, pattern detection features, and system functionality through contextual help, tooltips, glossary, tutorials, and FAQ.

### Wyckoff Methodology Content Additions (Team Review 2025-12-09)

**IMPORTANT:** This story has been enhanced based on a comprehensive Wyckoff methodology review by the full trading team (William - Wyckoff Mentor, Victoria - Volume Specialist, Rachel - Risk Manager). The following critical additions ensure authentic Wyckoff education:

#### HIGH PRIORITY Additions:

1. **Phase Glossary (Subtask 5.8)** - FOUNDATION OF WYCKOFF
   - Phase-A.md: Stopping the prior trend (PS, SC, AR characteristics)
   - Phase-B.md: Building the cause (range development, secondary tests)
   - Phase-C.md: The test (Spring/UTAD, final shakeout)
   - Phase-D.md: Trend emergence (SOS/LPS, professional markup)
   - Phase-E.md: Trend confirmation (continuation, distribution signals)
   - **Rationale:** Phases are THE foundation. Events and patterns only make sense within phase context. Original draft focused on events (PS, SC, AR, ST) but lacked the overarching phase framework.

2. **Expanded VSA Glossary (Subtask 5.7)** - VOLUME MAGNITUDE THRESHOLDS
   - Added: Ultra-High-Volume.md (>2.0x average - institutional activity)
   - Added: High-Volume.md (1.5-2.0x average - professional interest)
   - Added: Low-Volume.md (<0.5x average - lack of interest)
   - Added: Up-Thrust.md (Price rise on widening spread with volume - weakness)
   - **Rationale:** Our confidence scoring (Story 6.5) uses 1.5x, 2.0x, 2.5x volume thresholds. Users must understand these magnitudes. Original VSA content only covered "named" events, not magnitude analysis.

3. **Range Structure Glossary (Subtask 5.9)** - TRADING RANGE FUNDAMENTALS
   - Trading-Range.md: Horizontal consolidation, cause building
   - Trend.md: Directional movement, effect
   - Support.md: Demand line, accumulation boundary
   - Resistance.md: Supply line, distribution boundary
   - **Rationale:** Wyckoff methodology is fundamentally about ranges and trends. Patterns occur WITHIN ranges. Original draft had no foundational range/trend concepts.

#### MEDIUM PRIORITY Additions:

4. **Signal Confidence Glossary (Subtask 5.10)**
   - Signal-Confidence.md: Explains 120-point scoring system, volume (40pts), penetration (35pts), recovery (25pts), Creek bonus (+10pts), volume trend bonus (+10pts)
   - **Rationale:** Connects Story 11.6 notifications (â‰¥70% confidence threshold) to underlying scoring methodology. Users need to understand what "high confidence" means.

5. **Pattern Recognition Tutorials (Subtask 5.17)**
   - Identifying-Springs.md: Visual characteristics, volume requirements, Creek penetration
   - Identifying-UTAD.md: Distribution test, resistance violations, volume analysis
   - Identifying-SOS-Signals.md: Breakout confirmation, high volume validation
   - Identifying-LPS-Entries.md: Throwback timing, support testing, entry optimization
   - **Rationale:** Bridge between theoretical glossary content and practical pattern identification. Original tutorial section jumped from phase theory to campaigns without pattern recognition bridge.

6. **Risk Management Tutorials (Subtask 5.18)**
   - Structural-Stop-Placement.md: Using Wyckoff reference points (Creek, SC, PS) for stops
   - Position-Sizing.md: Portfolio heat calculation, campaign allocation rules
   - Three-Phase-Position-Building.md: How LPS entries build positions over time
   - **Rationale:** Story 11.6 sends risk warnings (portfolio heat >6%, campaign >50%) but users don't learn WHY these limits exist or HOW to manage Wyckoff-based risk.

#### Content Organization:
- **Glossary:** 50+ entries organized by category (patterns, phases, schematics, VSA, concepts, range structure, signal)
- **Tutorials:** 15+ step-by-step guides (basic usage, Wyckoff theory, pattern recognition, risk management)
- **FAQ:** 8+ common questions (methodology, signals, risk, campaigns)
- **Total Markdown files:** ~75+ help articles

#### Phase Context Teaching Approach:
All pattern glossary entries (Spring, UTAD, SOS, LPS) should reference the phase context:
- "Springs typically occur in **Phase C** during the final test of support..."
- "SOS signals mark the beginning of **Phase D** as the Composite Operator..."
- This reinforces that phase progression is primary, patterns are secondary indicators.

#### Cross-Linking Strategy:
Use `[[Term]]` syntax extensively:
- Phase-C.md should link to: `[[Spring]]`, `[[UTAD]]`, `[[Creek]]`, `[[Test]]`
- Spring.md should link to: `[[Phase-C]]`, `[[Creek]]`, `[[Stopping-Volume]]`, `[[UTAD]]`
- Signal-Confidence.md should link to: `[[Ultra-High-Volume]]`, `[[Creek]]`, `[[Recovery]]`

This ensures users can navigate from concepts â†’ patterns â†’ phases â†’ practical application seamlessly.

### Tech Stack - Content Management
[Source: docs/architecture/3-tech-stack.md]

**Markdown Processing:**
- Backend: `markdown-it-py` for Markdown to HTML conversion with plugins
- Frontend: `marked` or `markdown-it` for client-side rendering
- Frontmatter parsing: `python-frontmatter` for YAML metadata extraction
- HTML sanitization: `bleach` (backend), `DOMPurify` (frontend) for XSS prevention
- Syntax highlighting: `pygments` (backend), `highlight.js` (frontend)

**Full-Text Search:**
- PostgreSQL full-text search with `tsvector` and GIN indexes
- Query ranking with `ts_rank` function
- Snippet highlighting with `ts_headline` function
- Autocomplete suggestions from indexed content

**Content Structure:**
```
backend/src/help/content/
â”œâ”€â”€ glossary/
â”‚   â”œâ”€â”€ patterns/
â”‚   â”‚   â”œâ”€â”€ Spring.md
â”‚   â”‚   â”œâ”€â”€ UTAD.md
â”‚   â”‚   â”œâ”€â”€ SOS.md
â”‚   â”‚   â”œâ”€â”€ LPS.md
â”‚   â”‚   â”œâ”€â”€ PS.md (Preliminary Support)
â”‚   â”‚   â”œâ”€â”€ SC.md (Selling Climax)
â”‚   â”‚   â”œâ”€â”€ AR.md (Automatic Rally)
â”‚   â”‚   â”œâ”€â”€ ST.md (Secondary Test)
â”‚   â”‚   â”œâ”€â”€ SOW.md (Sign of Weakness)
â”‚   â”‚   â”œâ”€â”€ LPSY.md (Last Point of Supply)
â”‚   â”‚   â””â”€â”€ Backup.md
â”‚   â”œâ”€â”€ levels/
â”‚   â”‚   â”œâ”€â”€ Creek.md
â”‚   â”‚   â”œâ”€â”€ Ice.md
â”‚   â”‚   â””â”€â”€ Jump.md
â”‚   â”œâ”€â”€ phases/
â”‚   â”‚   â”œâ”€â”€ Phase-A.md
â”‚   â”‚   â”œâ”€â”€ Phase-B.md
â”‚   â”‚   â”œâ”€â”€ Phase-C.md
â”‚   â”‚   â”œâ”€â”€ Phase-D.md
â”‚   â”‚   â””â”€â”€ Phase-E.md
â”‚   â”œâ”€â”€ schematics/
â”‚   â”‚   â”œâ”€â”€ Accumulation-Schematic-1.md
â”‚   â”‚   â”œâ”€â”€ Accumulation-Schematic-2.md
â”‚   â”‚   â”œâ”€â”€ Distribution-Schematic-1.md
â”‚   â”‚   â””â”€â”€ Distribution-Schematic-2.md
â”‚   â”œâ”€â”€ vsa/
â”‚   â”‚   â”œâ”€â”€ No-Demand.md
â”‚   â”‚   â”œâ”€â”€ No-Supply.md
â”‚   â”‚   â”œâ”€â”€ Stopping-Volume.md
â”‚   â”‚   â”œâ”€â”€ Climactic-Volume.md
â”‚   â”‚   â”œâ”€â”€ Ultra-High-Volume.md
â”‚   â”‚   â”œâ”€â”€ High-Volume.md
â”‚   â”‚   â”œâ”€â”€ Low-Volume.md
â”‚   â”‚   â””â”€â”€ Up-Thrust.md
â”‚   â”œâ”€â”€ concepts/
â”‚   â”‚   â”œâ”€â”€ Composite-Operator.md
â”‚   â”‚   â”œâ”€â”€ Effort-vs-Result.md
â”‚   â”‚   â”œâ”€â”€ Cause-and-Effect.md
â”‚   â”‚   â””â”€â”€ Supply-and-Demand.md
â”‚   â”œâ”€â”€ range-structure/
â”‚   â”‚   â”œâ”€â”€ Trading-Range.md
â”‚   â”‚   â”œâ”€â”€ Trend.md
â”‚   â”‚   â”œâ”€â”€ Support.md
â”‚   â”‚   â””â”€â”€ Resistance.md
â”‚   â””â”€â”€ signal/
â”‚       â””â”€â”€ Signal-Confidence.md
â”œâ”€â”€ faq/
â”‚   â”œâ”€â”€ What-is-Wyckoff.md
â”‚   â”œâ”€â”€ How-are-signals-generated.md
â”‚   â”œâ”€â”€ What-is-Composite-Operator.md
â”‚   â”œâ”€â”€ How-to-read-Wyckoff-schematics.md
â”‚   â””â”€â”€ ...
â”œâ”€â”€ tutorials/
â”‚   â”œâ”€â”€ Reviewing-Your-First-Signal.md
â”‚   â”œâ”€â”€ Adjusting-Configuration.md
â”‚   â”œâ”€â”€ Understanding-Pattern-Confidence.md
â”‚   â”œâ”€â”€ Managing-Risk-Limits.md
â”‚   â”œâ”€â”€ Reading-Wyckoff-Charts.md
â”‚   â”œâ”€â”€ Identifying-Accumulation-Phases.md
â”‚   â”œâ”€â”€ Understanding-Cause-Building.md
â”‚   â”œâ”€â”€ Phase-Progression.md
â”‚   â”œâ”€â”€ Identifying-Springs.md
â”‚   â”œâ”€â”€ Identifying-UTAD.md
â”‚   â”œâ”€â”€ Identifying-SOS-Signals.md
â”‚   â”œâ”€â”€ Identifying-LPS-Entries.md
â”‚   â”œâ”€â”€ Structural-Stop-Placement.md
â”‚   â”œâ”€â”€ Position-Sizing.md
â”‚   â””â”€â”€ Three-Phase-Position-Building.md
â””â”€â”€ shortcuts.md
```

Markdown file format with YAML frontmatter:
```markdown
---
title: "Spring Pattern"
category: "GLOSSARY"
wyckoff_phase: "C"
tags: ["pattern", "wyckoff", "phase-c"]
keywords: "spring, shakeout, accumulation"
---

# Spring Pattern

A **Spring** is a price move below the support level (Creek)...
```

### Data Models

**Help Content Models:**
[Source: Architecture design based on AC requirements]

```python
# backend/src/models/help.py

from datetime import datetime
from typing import List, Optional, Literal, Dict
from pydantic import BaseModel, Field
from uuid import UUID

class HelpArticle(BaseModel):
    """Help article with Markdown content"""
    id: UUID
    slug: str = Field(..., max_length=200)  # URL-friendly identifier
    title: str = Field(..., max_length=300)
    content_markdown: str  # Raw Markdown
    content_html: str  # Rendered HTML
    category: Literal["GLOSSARY", "FAQ", "TUTORIAL", "REFERENCE"]
    tags: List[str]
    keywords: str  # For search indexing
    last_updated: datetime
    view_count: int = 0
    helpful_count: int = 0
    not_helpful_count: int = 0

    class Config:
        json_encoders = {
            datetime: lambda v: v.isoformat()
        }

class GlossaryTerm(BaseModel):
    """Wyckoff terminology glossary entry"""
    id: UUID
    term: str = Field(..., max_length=100)
    slug: str = Field(..., max_length=200)
    short_definition: str = Field(..., max_length=500)
    full_description: str  # Markdown
    full_description_html: str  # Rendered HTML
    wyckoff_phase: Optional[Literal["A", "B", "C", "D", "E"]] = None
    related_terms: List[str] = []  # List of slugs
    tags: List[str]
    last_updated: datetime

class TutorialStep(BaseModel):
    """Single step in a tutorial walkthrough"""
    step_number: int
    title: str = Field(..., max_length=200)
    content_markdown: str
    content_html: str
    action_required: Optional[str] = None  # e.g., "Click the Configuration button"
    ui_highlight: Optional[str] = None  # CSS selector to highlight

class Tutorial(BaseModel):
    """Step-by-step tutorial"""
    id: UUID
    slug: str = Field(..., max_length=200)
    title: str = Field(..., max_length=300)
    description: str = Field(..., max_length=1000)
    difficulty: Literal["BEGINNER", "INTERMEDIATE", "ADVANCED"]
    estimated_time_minutes: int
    steps: List[TutorialStep]
    tags: List[str]
    last_updated: datetime
    completion_count: int = 0

class KeyboardShortcut(BaseModel):
    """Keyboard shortcut definition"""
    id: int
    key_combination: str  # e.g., "Ctrl+K", "?", "Esc"
    action_description: str = Field(..., max_length=200)
    context: Literal["GLOBAL", "CHART", "SIGNALS", "SETTINGS"]

class HelpFeedback(BaseModel):
    """User feedback on help article"""
    id: UUID
    article_id: UUID
    helpful: bool
    user_comment: Optional[str] = Field(None, max_length=1000)
    created_at: datetime

class HelpSearchResult(BaseModel):
    """Search result with highlighting"""
    article_id: UUID
    slug: str
    title: str
    category: str
    snippet: str  # Highlighted excerpt with <mark> tags
    rank: float  # Search relevance score

class HelpArticleListResponse(BaseModel):
    """Paginated list of help articles"""
    articles: List[HelpArticle]
    total_count: int

class GlossaryResponse(BaseModel):
    """All glossary terms"""
    terms: List[GlossaryTerm]
    total_count: int

class SearchResponse(BaseModel):
    """Search results"""
    results: List[HelpSearchResult]
    query: str
    total_count: int
```

**TypeScript Types (Auto-generated):**
[Source: docs/architecture/3-tech-stack.md - pydantic-to-typescript]

After running `pydantic-to-typescript`, types will be available at:
- `frontend/src/types/HelpArticle.ts`
- `frontend/src/types/GlossaryTerm.ts`
- `frontend/src/types/Tutorial.ts`
- `frontend/src/types/KeyboardShortcut.ts`
- `frontend/src/types/HelpFeedback.ts`

### API Specifications

**Help Content Endpoints:**

```
GET /api/v1/help/articles
Query Parameters:
  - category: "GLOSSARY" | "FAQ" | "TUTORIAL" | "REFERENCE" | "ALL" (default: "ALL")
  - limit: integer (default: 50, max: 100)
  - offset: integer (default: 0)

Response: 200 OK
{
  "articles": [
    {
      "id": "uuid",
      "slug": "what-is-wyckoff",
      "title": "What is Wyckoff Method?",
      "content_markdown": "...",
      "content_html": "<p>...</p>",
      "category": "FAQ",
      "tags": ["wyckoff", "basics"],
      "keywords": "wyckoff method accumulation distribution",
      "last_updated": "2024-03-13T10:00:00Z",
      "view_count": 127,
      "helpful_count": 45,
      "not_helpful_count": 3
    }
  ],
  "total_count": 42
}

Error Responses:
- 400 Bad Request: Invalid query parameters
```

```
GET /api/v1/help/articles/{slug}
Response: 200 OK
{
  "id": "uuid",
  "slug": "spring-pattern",
  "title": "Spring Pattern",
  "content_markdown": "...",
  "content_html": "<h1>Spring Pattern</h1><p>...</p>",
  "category": "GLOSSARY",
  "tags": ["pattern", "phase-c"],
  "keywords": "spring shakeout test",
  "last_updated": "2024-03-13T10:00:00Z",
  "view_count": 256,
  "helpful_count": 89,
  "not_helpful_count": 5
}

Error Responses:
- 404 Not Found: Article doesn't exist
```

```
GET /api/v1/help/search
Query Parameters:
  - q: string (required) - Search query
  - limit: integer (default: 20)

Response: 200 OK
{
  "results": [
    {
      "article_id": "uuid",
      "slug": "spring-pattern",
      "title": "Spring Pattern",
      "category": "GLOSSARY",
      "snippet": "A <mark>Spring</mark> is a price move below support...",
      "rank": 0.85
    }
  ],
  "query": "spring",
  "total_count": 3
}

Error Responses:
- 400 Bad Request: Missing or invalid query parameter
```

```
GET /api/v1/help/glossary
Query Parameters:
  - wyckoff_phase: "A" | "B" | "C" | "D" | "E" (optional)

Response: 200 OK
{
  "terms": [
    {
      "id": "uuid",
      "term": "Spring",
      "slug": "spring",
      "short_definition": "A price move below support that tests for supply",
      "full_description": "...",
      "full_description_html": "<p>...</p>",
      "wyckoff_phase": "C",
      "related_terms": ["utad", "test", "creek"],
      "tags": ["pattern", "accumulation"],
      "last_updated": "2024-03-13T10:00:00Z"
    }
  ],
  "total_count": 15
}
```

```
POST /api/v1/help/feedback
Request Body:
{
  "article_id": "uuid",
  "helpful": true,
  "user_comment": "Very helpful explanation!"
}

Response: 201 Created
{
  "success": true,
  "feedback_id": "uuid"
}

Error Responses:
- 400 Bad Request: Invalid request body
- 404 Not Found: Article doesn't exist
```

### Component Specifications

**Backend Components:**
[Source: docs/architecture/6-components.md]

**HelpContentLoader** (`backend/src/help/content_loader.py`):
- NEW component
- Responsibilities: Load Markdown files from filesystem, parse YAML frontmatter, cache parsed content
- Technology: `python-frontmatter`, file watching with `watchdog` library (optional)

**MarkdownRenderer** (`backend/src/help/markdown_renderer.py`):
- NEW component
- Responsibilities: Convert Markdown to HTML, sanitize output, add syntax highlighting, handle custom extensions
- Technology: `markdown-it-py`, `bleach`, `pygments`

**HelpRepository** (`backend/src/repositories/help_repository.py`):
- NEW component
- Responsibilities: Database operations for help content, full-text search, feedback tracking
- Technology: SQLAlchemy async, PostgreSQL full-text search

**Frontend Components:**
[Source: docs/architecture/6-components.md, docs/architecture/10-unified-project-structure.md]

**HelpCenter.vue**:
- New component location: `frontend/src/components/help/HelpCenter.vue`
- Responsibilities: Main help center with sidebar navigation, search, content display
- Technology: Vue 3 Composition API, PrimeVue (InputText for search, Menu for sidebar)

**GlossaryView.vue**:
- New component location: `frontend/src/components/help/GlossaryView.vue`
- Responsibilities: Display glossary terms, filter by phase, search
- Technology: Vue 3 Composition API, PrimeVue (DataView or custom list)

**FAQView.vue**:
- New component location: `frontend/src/components/help/FAQView.vue`
- Responsibilities: Display FAQ with accordion, search filtering
- Technology: Vue 3 Composition API, PrimeVue Accordion

**TutorialView.vue** and **TutorialWalkthrough.vue**:
- New component location: `frontend/src/components/help/`
- Responsibilities: Tutorial listing and step-by-step walkthrough
- Technology: Vue 3 Composition API, PrimeVue (Card, Button, Steps)

**KeyboardShortcutsOverlay.vue**:
- New component location: `frontend/src/components/help/KeyboardShortcutsOverlay.vue`
- Responsibilities: Display keyboard shortcuts in overlay
- Technology: Vue 3 Composition API, PrimeVue Dialog

**HelpIcon.vue**:
- New component location: `frontend/src/components/help/HelpIcon.vue`
- Responsibilities: "?" icon button that opens help dialog
- Technology: Vue 3 Composition API, PrimeVue (Button, Dialog)

**MarkdownRenderer.vue**:
- New component location: `frontend/src/components/help/MarkdownRenderer.vue`
- Responsibilities: Render Markdown to safe HTML
- Technology: `marked` library, DOMPurify for sanitization

**Pinia Store - useHelpStore**:
- New store location: `frontend/src/stores/helpStore.ts`
- State: articles, glossaryTerms, searchResults, currentArticle, isLoading, error, cache
- Actions: fetchArticles(), fetchArticle(slug), searchHelp(query), fetchGlossary(), submitFeedback()
- Getters: getArticleBySlug, getTermByName, articlesGroupedByCategory
- Integrates with useApi composable

### File Locations

**Backend Files to Create:**
[Source: docs/architecture/10-unified-project-structure.md]

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ routes/
â”‚   â”‚       â””â”€â”€ help.py                     # CREATE: Help API routes
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ help.py                         # CREATE: Help content models
â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ help_repository.py              # CREATE: HelpRepository
â”‚   â”œâ”€â”€ help/
â”‚   â”‚   â”œâ”€â”€ content_loader.py               # CREATE: Markdown file loader
â”‚   â”‚   â”œâ”€â”€ markdown_renderer.py            # CREATE: Markdown to HTML renderer
â”‚   â”‚   â””â”€â”€ content/                        # CREATE: Content directory
â”‚   â”‚       â”œâ”€â”€ glossary/
â”‚   â”‚       â”‚   â”œâ”€â”€ Spring.md
â”‚   â”‚       â”‚   â”œâ”€â”€ UTAD.md
â”‚   â”‚       â”‚   â”œâ”€â”€ SOS.md
â”‚   â”‚       â”‚   â”œâ”€â”€ Creek.md
â”‚   â”‚       â”‚   â”œâ”€â”€ Ice.md
â”‚   â”‚       â”‚   â””â”€â”€ Jump.md
â”‚   â”‚       â”œâ”€â”€ faq/
â”‚   â”‚       â”‚   â”œâ”€â”€ What-is-Wyckoff.md
â”‚   â”‚       â”‚   â”œâ”€â”€ How-are-signals-generated.md
â”‚   â”‚       â”‚   â””â”€â”€ How-is-risk-calculated.md
â”‚   â”‚       â”œâ”€â”€ tutorials/
â”‚   â”‚       â”‚   â”œâ”€â”€ Reviewing-Your-First-Signal.md
â”‚   â”‚       â”‚   â””â”€â”€ Adjusting-Configuration.md
â”‚   â”‚       â””â”€â”€ shortcuts.md
â”œâ”€â”€ alembic/
â”‚   â””â”€â”€ versions/
â”‚       â””â”€â”€ {timestamp}_add_help_tables.py  # CREATE: Migration for help_articles, help_feedback tables
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â”œâ”€â”€ test_content_loader.py          # CREATE: Unit tests for content loading
â”‚   â”‚   â”œâ”€â”€ test_markdown_renderer.py       # CREATE: Unit tests for Markdown rendering
â”‚   â”‚   â””â”€â”€ test_help_search.py             # CREATE: Unit tests for search functionality
â”‚   â””â”€â”€ integration/
â”‚       â””â”€â”€ test_help_api.py                # CREATE: Integration tests for help endpoints
```

**Frontend Files to Create:**
[Source: docs/architecture/10-unified-project-structure.md]

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ help/
â”‚   â”‚       â”œâ”€â”€ HelpCenter.vue              # CREATE: Main help center
â”‚   â”‚       â”œâ”€â”€ GlossaryView.vue            # CREATE: Glossary display
â”‚   â”‚       â”œâ”€â”€ FAQView.vue                 # CREATE: FAQ with accordion
â”‚   â”‚       â”œâ”€â”€ TutorialView.vue            # CREATE: Tutorial listing
â”‚   â”‚       â”œâ”€â”€ TutorialWalkthrough.vue     # CREATE: Step-by-step tutorial
â”‚   â”‚       â”œâ”€â”€ KeyboardShortcutsOverlay.vue # CREATE: Keyboard shortcuts overlay
â”‚   â”‚       â”œâ”€â”€ HelpIcon.vue                # CREATE: Help icon button
â”‚   â”‚       â”œâ”€â”€ MarkdownRenderer.vue        # CREATE: Markdown to HTML renderer
â”‚   â”‚       â””â”€â”€ ArticleFeedback.vue         # CREATE: Feedback buttons
â”‚   â”œâ”€â”€ composables/
â”‚   â”‚   â”œâ”€â”€ useTooltip.ts                   # CREATE: Tooltip helper
â”‚   â”‚   â”œâ”€â”€ useKeyboardShortcuts.ts         # CREATE: Global keyboard shortcuts
â”‚   â”‚   â””â”€â”€ useGlobalSearch.ts              # CREATE: Search helper
â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â””â”€â”€ helpStore.ts                    # CREATE: Pinia store for help content
â”‚   â”œâ”€â”€ types/                              # AUTO-GENERATED: TypeScript types
â”‚   â”‚   â”œâ”€â”€ HelpArticle.ts
â”‚   â”‚   â”œâ”€â”€ GlossaryTerm.ts
â”‚   â”‚   â”œâ”€â”€ Tutorial.ts
â”‚   â”‚   â”œâ”€â”€ KeyboardShortcut.ts
â”‚   â”‚   â””â”€â”€ HelpFeedback.ts
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ tooltips.ts                     # CREATE: Tooltip content mapping
â”‚   â””â”€â”€ router/
â”‚       â””â”€â”€ index.ts                        # MODIFY: Add help routes
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ components/
â”‚       â”œâ”€â”€ HelpCenter.spec.ts              # CREATE: Component tests
â”‚       â”œâ”€â”€ GlossaryView.spec.ts            # CREATE: Glossary tests
â”‚       â”œâ”€â”€ FAQView.spec.ts                 # CREATE: FAQ tests
â”‚       â”œâ”€â”€ TutorialView.spec.ts            # CREATE: Tutorial tests
â”‚       â””â”€â”€ KeyboardShortcutsOverlay.spec.ts # CREATE: Shortcuts tests
```

**E2E Tests:**
```
tests/
â””â”€â”€ e2e/
    â””â”€â”€ help-system.spec.ts                 # CREATE: Playwright E2E tests
```

### Technical Constraints

**Markdown Processing:**

- Use `python-frontmatter` to parse YAML frontmatter from Markdown files
- Frontmatter format:
  ```yaml
  ---
  title: "Article Title"
  category: "GLOSSARY"
  tags: ["tag1", "tag2"]
  keywords: "search keywords here"
  ---
  ```
- Render Markdown with `markdown-it-py` (backend) or `marked` (frontend)
- Enable plugins: tables, code fencing with syntax highlighting, task lists
- Sanitize HTML output to prevent XSS attacks

**Full-Text Search Implementation:**

PostgreSQL full-text search setup:
```sql
-- Create tsvector column for search
ALTER TABLE help_articles ADD COLUMN search_vector tsvector;

-- Update search_vector with indexed content
UPDATE help_articles SET search_vector =
  to_tsvector('english', title || ' ' || content_text || ' ' || keywords);

-- Create GIN index for fast search
CREATE INDEX idx_help_articles_search ON help_articles USING GIN(search_vector);

-- Search query with ranking
SELECT
  id, slug, title, category,
  ts_rank(search_vector, query) AS rank,
  ts_headline('english', content_text, query, 'MaxWords=50, MinWords=15') AS snippet
FROM help_articles,
     to_tsquery('english', 'spring & pattern') AS query
WHERE search_vector @@ query
ORDER BY rank DESC
LIMIT 20;
```

**Tooltip Implementation:**
[Source: docs/architecture/3-tech-stack.md - PrimeVue]

PrimeVue Tooltip directive usage:
```vue
<template>
  <!-- Simple tooltip -->
  <span v-tooltip="'This is a tooltip'">Hover me</span>

  <!-- Rich HTML tooltip -->
  <span v-tooltip.top="tooltipContent">
    Win Rate
  </span>
</template>

<script setup>
const tooltipContent = {
  value: '<strong>Win Rate</strong><br/>Percentage of winning trades out of total trades',
  escape: false,
  class: 'custom-tooltip'
};
</script>
```

Tooltip configuration:
- Delay: 300ms before showing
- Position: auto (top, bottom, left, right based on available space)
- Theme: dark background with white text
- Max width: 300px

**Keyboard Shortcuts Implementation:**

Global keyboard listener in `useKeyboardShortcuts.ts`:
```typescript
export function useKeyboardShortcuts() {
  const showShortcutsOverlay = ref(false);

  onMounted(() => {
    window.addEventListener('keydown', handleKeyPress);
  });

  onUnmounted(() => {
    window.removeEventListener('keydown', handleKeyPress);
  });

  function handleKeyPress(event: KeyboardEvent) {
    // ? key - show shortcuts overlay
    if (event.key === '?' && !event.ctrlKey && !event.metaKey) {
      event.preventDefault();
      showShortcutsOverlay.value = true;
    }

    // Esc key - close overlays
    if (event.key === 'Escape') {
      showShortcutsOverlay.value = false;
    }

    // / key - focus search
    if (event.key === '/' && !event.ctrlKey && !event.metaKey) {
      event.preventDefault();
      focusSearch();
    }
  }

  return { showShortcutsOverlay };
}
```

**Content Caching Strategy:**

Backend caching:
- Cache parsed Markdown content in memory
- Reload cache on file changes (use file watching in development)
- Cache TTL: indefinite (only reload on file change or server restart)

Frontend caching:
- Cache help articles in Pinia store for 24 hours
- Cache glossary terms indefinitely (reload only on manual refresh)
- Store cache timestamp in localStorage

**Custom Markdown Extensions:**

Glossary term links:
```markdown
The [[Spring]] pattern is detected when...
```

Rendered as:
```html
The <a href="/help/glossary/spring" class="glossary-link">Spring</a> pattern is detected when...
```

Implementation in Markdown renderer:
```python
import re

def process_glossary_links(markdown_text):
    """Convert [[Term]] to HTML link"""
    pattern = r'\[\[([^\]]+)\]\]'

    def replace_link(match):
        term = match.group(1)
        slug = term.lower().replace(' ', '-')
        return f'<a href="/help/glossary/{slug}" class="glossary-link">{term}</a>'

    return re.sub(pattern, replace_link, markdown_text)
```

### Security and Error Handling

**XSS Prevention:**
[Source: docs/architecture/14-security-and-performance.md]

- Backend: Sanitize rendered HTML with `bleach` library
- Allowed tags: p, h1-h6, a, ul, ol, li, strong, em, code, pre, table, thead, tbody, tr, th, td, blockquote
- Allowed attributes: href (for links), class (for styling)
- Remove all JavaScript and event handlers

- Frontend: Sanitize HTML with DOMPurify before rendering
```typescript
import DOMPurify from 'dompurify';

const sanitizedHTML = DOMPurify.sanitize(htmlContent, {
  ALLOWED_TAGS: ['p', 'h1', 'h2', 'h3', 'a', 'ul', 'ol', 'li', 'strong', 'code', 'pre'],
  ALLOWED_ATTR: ['href', 'class']
});
```

**Error Handling:**
[Source: docs/architecture/16-error-handling-strategy.md]

```json
{
  "error": {
    "code": "HELP_ARTICLE_NOT_FOUND",
    "message": "Help article not found",
    "details": {
      "slug": "invalid-slug"
    },
    "timestamp": "2024-03-13T13:00:00Z",
    "request_id": "uuid"
  }
}
```

**Logging:**
[Source: docs/architecture/17-monitoring-and-observability.md]

Log search queries and feedback for analytics:
```python
logger.info(
    "Help article searched",
    extra={
        "query": query,
        "result_count": len(results),
        "search_latency_ms": elapsed,
        "correlation_id": correlation_id
    }
)
```

### Testing

**Backend Testing:**
[Source: docs/architecture/12-testing-strategy.md]

- **Unit Tests (pytest)**: Test Markdown parsing, frontmatter extraction, glossary link conversion, search query generation
- **Integration Tests (pytest)**: Test full-text search with database, content loading from filesystem, feedback submission
- **Search Performance Tests**: Verify search responds in < 200ms for typical queries

**Frontend Testing:**
[Source: docs/architecture/12-testing-strategy.md]

- **Component Tests (Vitest + Vue Testing Library)**: Test HelpCenter navigation, glossary filtering, FAQ accordion, tutorial walkthrough steps, keyboard shortcuts overlay
- **Store Tests (Vitest)**: Test useHelpStore actions and state updates, caching logic
- **Composable Tests (Vitest)**: Test useKeyboardShortcuts key handling, useTooltip registration

**E2E Testing:**
[Source: docs/architecture/12-testing-strategy.md]

- **Playwright Tests**: Full user flow opening help center â†’ searching â†’ viewing article â†’ submitting feedback
- Test keyboard shortcuts: press ? key â†’ overlay appears
- Test tooltip hover interactions
- Test tutorial navigation through all steps

### Testing Standards

**Test File Locations:**
[Source: docs/architecture/12-testing-strategy.md]

- Backend unit tests: `backend/tests/unit/test_content_loader.py`, `backend/tests/unit/test_markdown_renderer.py`, `backend/tests/unit/test_help_search.py`
- Backend integration tests: `backend/tests/integration/test_help_api.py`
- Frontend component tests: `frontend/tests/components/HelpCenter.spec.ts`, `frontend/tests/components/GlossaryView.spec.ts`, etc.
- E2E tests: `tests/e2e/help-system.spec.ts` (Playwright)

**Testing Frameworks:**
[Source: docs/architecture/3-tech-stack.md]

- Backend: pytest 8.0+ with pytest-mock, factory-boy for fixtures
- Frontend: Vitest 1.2+ for component tests, Vue Testing Library integration
- E2E: Playwright 1.41+ with keyboard event simulation

**Test Coverage Requirements:**

- Unit tests: 80% coverage minimum for new code
- Integration tests: Cover happy path (search returns results, article loads), error scenarios (article not found, empty search), performance validation (< 200ms search time)
- E2E tests: Cover complete user journey opening help â†’ searching â†’ reading article â†’ submitting feedback

**Mock Data Requirements:**

- Sample Markdown files with various frontmatter configurations
- Mock glossary terms with related terms
- Mock tutorial with multiple steps
- Mock search results with highlighted snippets
- Test XSS prevention with malicious HTML input

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-20 | 1.0 | Initial story draft created with comprehensive technical details from PRD Epic 11 and Architecture docs | Scrum Master (Bob) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent during implementation_

### Debug Log References
_To be populated by dev agent during implementation_

### Completion Notes List
_To be populated by dev agent during implementation_

### File List
_To be populated by dev agent during implementation_

## QA Results
_To be populated by QA agent during testing_
