# Story 0.6: Asset-Class Integration Testing - Amendment Document

## âœ… AMENDMENTS APPLIED - 2025-11-15

**This amendment document has been FULLY INTEGRATED into the main story document.**

**Integration Date:** 2025-11-15
**Integrated By:** Bob (Scrum Master)
**Target Document:** [0.6.asset-class-integration-testing.md](./0.6.asset-class-integration-testing.md)

**Summary of Changes Applied:**
- Estimate updated: 5 â†’ 9 story points
- Added AC 9 (Multi-Spring Campaign Validation)
- Added AC 10 (Minimum Confidence Threshold Enforcement)
- Enhanced AC 2, 3, 5, 6, 7 with amendment details
- Added Task 11 (Multi-Spring Campaign Tests)
- Enhanced Tasks 2, 3, 5, 6, 7 with detailed test implementations
- Updated Definition of Done with all new requirements
- Added position sizing helper function and documentation

**Original Status:** APPROVED WITH AMENDMENTS (see below for historical record)

---

# HISTORICAL RECORD - Original Amendment Document

## Document Control

**Date:** 2025-11-15
**Prepared By:** William (Wyckoff Education Specialist) on behalf of Wyckoff Team
**For:** Bob (Scrum Master)
**Story:** Epic 0, Story 0.6 - Asset-Class Integration Testing
**Status:** âœ… APPROVED WITH AMENDMENTS
**Priority:** ðŸŸ¡ HIGH

---

## Executive Summary

The Wyckoff team has reviewed Story 0.6 (Asset-Class Integration Testing) and finds the core acceptance criteria **sound and well-structured**. However, we've identified **6 critical gaps** that must be addressed before development begins to ensure comprehensive validation of Epic 0's multi-asset architecture.

**Recommendation:** APPROVE Story 0.6 with the amendments detailed below.

---

## Team Review Results

### âœ… **Approved Elements (No Changes Needed)**

1. **End-to-End Testing Approach** (AC 2-6): Complete pipeline validation from bars â†’ pattern â†’ confidence â†’ signal
2. **Asset Class Segregation** (AC 2-4): Separate test coverage for stocks, forex, CFDs
3. **Performance Benchmarks** (AC 8): <150ms targets align with NFR1 real-time requirements
4. **Confidence Cap Enforcement** (AC 3): Critical test for forex 85-point ceiling
5. **Comparison Testing** (AC 7): Side-by-side stock vs forex comparison provides educational value
6. **Memory Leak Testing** (Task 9): Validates scorer singleton pattern working correctly

---

## Critical Amendments Required

### **Amendment 1: Clarify Spring Volume Weight Discrepancy** ðŸ”´ **BLOCKER**

**Issue:** AC 2 states "Verify volume weight 40 points (stock formula)" but the current Spring confidence scoring formula (Story 5.4) uses:
- Volume Quality: **40 points**
- Penetration Depth: **35 points**
- Recovery Speed: **25 points**

**Source of Confusion:** Need to verify this is correct for SPRING patterns. Story 6.5 (SOS) uses different weights:
- Volume Strength: **35 points**
- Penetration Quality: **35 points**
- Recovery Quality: **25 points**

**Required Action:**

1. **Verify Spring Formula** in `spring_detector.py:calculate_spring_confidence()` delegation
2. **Update AC 2** with correct component weights:
   ```markdown
   - Verify volume weight: 40 points (Spring pattern)
   - Verify penetration weight: 35 points
   - Verify recovery weight: 25 points
   - Verify Creek strength bonus: +10 points
   - Verify volume trend bonus: +10 points
   - Total base: 100 points, Max with bonuses: 120 points
   ```

3. **Add to Task 2:**
   ```python
   def test_stock_spring_component_scores():
       """Verify Spring uses 40pts volume weight."""
       spring = detect_spring(range, bars, phase, symbol="AAPL")
       confidence = calculate_spring_confidence(spring, creek, [])

       # Verify component score structure
       assert "volume_quality" in confidence.component_scores
       assert confidence.component_scores["volume_quality"] <= 40
       assert confidence.component_scores["penetration_depth"] <= 35
       assert confidence.component_scores["recovery_speed"] <= 25
   ```

**Assigned To:** Victoria (Pattern Quality) + Wayne (Volume Analysis)
**Deadline:** Before Task 2 implementation starts

---

### **Amendment 2: Define "Perfect Pattern" Characteristics** ðŸŸ¡ **HIGH PRIORITY**

**Issue:** AC 3 and Task 3 mention "perfect pattern" tests but don't define what constitutes a perfect Spring or SOS pattern. This ambiguity will cause test implementation confusion.

**Required Action:**

Add to **Task 3** (Forex Spring Integration Tests):

```python
def test_forex_perfect_spring_confidence_cap():
    """
    Test that PERFECT spring pattern caps at 85 for forex.

    Perfect Spring Definition (Wyckoff textbook example):
    - Penetration: 1.5% below Creek (ideal 1-2% range)
    - Volume: 0.3x average (ultra-low, <0.3x tier = 40pts)
    - Recovery: 1 bar (immediate demand = 25pts)
    - Creek Strength: 80+ (3+ successful tests = 10pts bonus)
    - Volume Trend: DECLINING across 3+ tests (10pts bonus)

    Expected Raw Score: 40 + 35 + 25 + 10 + 10 = 120 points

    Stock Normalized: (120/120) * 100 = 100 confidence
    Forex Normalized: (120/120) * 85 = 85 confidence (CAPPED)

    This test PROVES the humility tax in action.
    """
    # Create perfect spring fixture
    creek_level = Decimal("1.1000")
    perfect_bars = create_perfect_spring_bars(
        creek_level=creek_level,
        penetration_pct=Decimal("0.015"),  # 1.5%
        volume_ratio=Decimal("0.29"),      # 0.29x (ultra-low)
        recovery_bars=1,                    # Immediate
        symbol="EUR/USD"
    )

    # Create Creek with 80+ strength
    creek = create_strong_creek(
        price=creek_level,
        strength_score=85,
        touch_count=4,
        volume_trend="DECREASING"
    )

    # Detect spring
    spring = detect_spring(range, perfect_bars, WyckoffPhase.C, "EUR/USD")
    assert spring is not None

    # Calculate confidence
    confidence = calculate_spring_confidence(spring, creek, previous_tests=[])

    # CRITICAL: Forex perfect pattern caps at 85, not 100
    assert confidence.total_score == 85, (
        f"Perfect forex spring should cap at 85, got {confidence.total_score}"
    )

    # Document components
    logger.info(
        "perfect_spring_forex_cap_test",
        volume_score=confidence.component_scores["volume_quality"],
        penetration_score=confidence.component_scores["penetration_depth"],
        recovery_score=confidence.component_scores["recovery_speed"],
        creek_bonus=confidence.component_scores.get("creek_strength_bonus", 0),
        volume_trend_bonus=confidence.component_scores.get("volume_trend_bonus", 0),
        raw_score=sum(confidence.component_scores.values()),
        normalized_score=confidence.total_score,
        message="Perfect pattern demonstrates forex 85-point ceiling"
    )
```

Add corresponding test for **Stock Perfect Spring** in Task 2:

```python
def test_stock_perfect_spring_confidence_100():
    """Same perfect pattern, stock symbol, should hit 100."""
    # Same fixture, symbol="AAPL"
    spring = detect_spring(range, perfect_bars, WyckoffPhase.C, "AAPL")
    confidence = calculate_spring_confidence(spring, creek, previous_tests=[])

    assert confidence.total_score == 100, (
        f"Perfect stock spring should score 100, got {confidence.total_score}"
    )
```

**Assigned To:** Victoria (Pattern Quality)
**Deadline:** Before Task 3 implementation

---

### **Amendment 3: Add Position Sizing to Comparison Tests** ðŸŸ¡ **HIGH PRIORITY**

**Issue:** AC 7 compares confidence scores but doesn't show the **risk management implications** (position sizing). Traders need to understand HOW the confidence difference translates to actual position size differences.

**Required Action:**

Expand **Task 7** (Confidence Score Comparison Tests):

```python
def test_stock_vs_forex_confidence_with_position_sizing():
    """
    Compare identical spring patterns with position sizing implications.

    This test demonstrates WHY forex patterns require smaller positions
    even when the underlying pattern structure is identical.
    """
    # Same pattern structure, different symbols
    creek_level = Decimal("100.00")
    identical_pattern_bars = create_spring_bars(
        creek_level=creek_level,
        penetration_pct=Decimal("0.02"),  # 2% penetration
        volume_ratio=Decimal("0.4"),      # 0.4x volume (GOOD tier)
        recovery_bars=2,
    )

    # Detect with stock symbol
    stock_range = create_trading_range(creek_level, symbol="AAPL")
    stock_spring = detect_spring(
        stock_range, identical_pattern_bars, WyckoffPhase.C, symbol="AAPL"
    )
    stock_confidence = calculate_spring_confidence(stock_spring, stock_range.creek, [])

    # Detect with forex symbol
    forex_range = create_trading_range(creek_level, symbol="EUR/USD")
    forex_spring = detect_spring(
        forex_range, identical_pattern_bars, WyckoffPhase.C, symbol="EUR/USD"
    )
    forex_confidence = calculate_spring_confidence(forex_spring, forex_range.creek, [])

    # Stock should score higher (volume confirmation)
    assert stock_spring.confidence > forex_spring.confidence

    # Calculate confidence tiers and multipliers
    stock_tier, stock_multiplier = get_confidence_tier(
        stock_confidence.total_score, stock_spring.asset_class
    )
    forex_tier, forex_multiplier = get_confidence_tier(
        forex_confidence.total_score, forex_spring.asset_class
    )

    # Calculate position sizes for $100k account, 2% max risk
    account_size = Decimal("100000")
    max_risk_pct = Decimal("0.02")

    stock_position_risk = account_size * max_risk_pct * Decimal(str(stock_multiplier))
    forex_position_risk = account_size * max_risk_pct * Decimal(str(forex_multiplier))

    # Document differences (EducationalValue++)
    print("\n" + "="*70)
    print("RISK COMPARISON: IDENTICAL PATTERN, DIFFERENT ASSET CLASSES")
    print("="*70)
    print(f"\nðŸ“Š Pattern Structure (Identical):")
    print(f"  - Penetration: {stock_spring.penetration_pct:.2%} below Creek")
    print(f"  - Volume: {stock_spring.volume_ratio:.2f}x average")
    print(f"  - Recovery: {stock_spring.recovery_bars} bars")
    print(f"\nðŸ“ˆ Stock (AAPL) - HIGH Volume Reliability:")
    print(f"  - Confidence: {stock_confidence.total_score:.1f}/100")
    print(f"  - Quality Tier: {stock_tier}")
    print(f"  - Position Multiplier: {stock_multiplier:.2f}")
    print(f"  - Account Risk: ${stock_position_risk:,.2f} ({stock_multiplier * 2:.1f}%)")
    print(f"  - Volume Interpretation: REAL institutional shares traded")
    print(f"\nðŸ’± Forex (EUR/USD) - LOW Volume Reliability:")
    print(f"  - Confidence: {forex_confidence.total_score:.1f}/85")
    print(f"  - Quality Tier: {forex_tier}")
    print(f"  - Position Multiplier: {forex_multiplier:.2f}")
    print(f"  - Account Risk: ${forex_position_risk:,.2f} ({forex_multiplier * 2:.1f}%)")
    print(f"  - Volume Interpretation: TICK volume (activity only)")
    print(f"\nâš ï¸  Position Size Difference:")
    position_diff_pct = (stock_multiplier - forex_multiplier) * 2
    position_diff_usd = stock_position_risk - forex_position_risk
    print(f"  - {position_diff_pct:.1f}% of account (${position_diff_usd:,.2f})")
    print(f"  - Reason: Tick volume lacks institutional confirmation")
    print("="*70 + "\n")

    # Assertions for test validation
    assert stock_multiplier > forex_multiplier, (
        "Stock multiplier must be higher due to HIGH volume reliability"
    )
    assert stock_position_risk > forex_position_risk, (
        "Stock position should be larger for identical pattern"
    )
```

**Additional Helper Function Needed:**

```python
def get_confidence_tier(score: float, asset_class: str) -> tuple[str, float]:
    """
    Get confidence tier and position multiplier (from risk-management guidelines).

    Returns:
        tuple: (tier_name, multiplier)
    """
    if asset_class == "stock":
        if score >= 90:
            return ("EXCELLENT", 1.00)
        elif score >= 80:
            return ("GOOD", 0.75)
        elif score >= 70:
            return ("MARGINAL", 0.50)
        else:
            return ("REJECT", 0.00)
    else:  # forex
        if score >= 80:
            return ("EXCELLENT", 0.80)
        elif score >= 75:
            return ("GOOD", 0.60)
        elif score >= 70:
            return ("MARGINAL", 0.40)
        else:
            return ("REJECT", 0.00)
```

**Assigned To:** Rachel (Risk Management)
**Deadline:** Before Task 7 implementation

---

### **Amendment 4: Add Multi-Spring Campaign Integration Test** ðŸŸ¡ **HIGH PRIORITY**

**Issue:** Story 5.6 implemented multi-spring detection with volume trend analysis and risk aggregation. Story 0.6 doesn't test this critical functionality across asset classes.

**Required Action:**

Add **NEW TASK 11: Multi-Spring Campaign Tests**

```markdown
### **Task 11: Multi-Spring Campaign Integration Tests** (Story 5.6 Integration)

- [ ] Test stock 3-spring accumulation campaign (AAPL):
  ```python
  def test_stock_multi_spring_accumulation_campaign():
      """
      Test 3-spring accumulation with DECLINING volume (professional pattern).

      Campaign Structure:
      - Spring 1 (Bar 25): 0.6x volume, 2.0% penetration
      - Spring 2 (Bar 40): 0.5x volume, 2.5% penetration (deeper, lower volume)
      - Spring 3 (Bar 55): 0.3x volume, 3.0% penetration (deepest, lowest volume)

      Expected:
      - Volume Trend: DECLINING (0.6 â†’ 0.5 â†’ 0.3)
      - Risk Level: LOW (professional accumulation)
      - Best Spring: Spring 3 (lowest volume per Wyckoff hierarchy)
      """
      symbol = "AAPL"
      bars = create_three_spring_campaign(
          symbol=symbol,
          volumes=[Decimal("0.6"), Decimal("0.5"), Decimal("0.3")],
          penetrations=[Decimal("0.02"), Decimal("0.025"), Decimal("0.03")],
      )

      detector = SpringDetector()
      history = detector.detect_all_springs(range, bars, WyckoffPhase.C)

      assert history.spring_count == 3, "Should detect 3 springs"
      assert history.volume_trend == "DECLINING", "Volume should decline (professional)"
      assert history.risk_level == "LOW", "Declining volume = LOW risk"

      # Best spring = lowest volume (Wyckoff hierarchy)
      assert history.best_spring.volume_ratio == Decimal("0.3")

      # All springs should be stock asset class
      for spring in history.springs:
          assert spring.asset_class == "stock"
          assert spring.volume_reliability == "HIGH"
  ```

- [ ] Test forex 3-spring accumulation campaign (EUR/USD):
  ```python
  def test_forex_multi_spring_accumulation_campaign():
      """
      Same campaign structure, forex symbol - verify confidence capping.

      CRITICAL TEST: Each spring in campaign should cap at 85 confidence.
      """
      symbol = "EUR/USD"
      bars = create_three_spring_campaign(
          symbol=symbol,
          volumes=[Decimal("0.6"), Decimal("0.5"), Decimal("0.3")],
          penetrations=[Decimal("0.02"), Decimal("0.025"), Decimal("0.03")],
      )

      detector = SpringDetector()
      history = detector.detect_all_springs(range, bars, WyckoffPhase.C)

      # Same campaign characteristics
      assert history.spring_count == 3
      assert history.volume_trend == "DECLINING"  # Trend detection unchanged
      assert history.risk_level == "LOW"  # Risk level unchanged

      # Best spring same selection logic
      assert history.best_spring.volume_ratio == Decimal("0.3")

      # BUT: All springs cap at 85 confidence
      for spring in history.springs:
          assert spring.asset_class == "forex"
          assert spring.volume_reliability == "LOW"

          # Calculate confidence for each spring
          confidence = calculate_spring_confidence(spring, range.creek, [])
          assert confidence.total_score <= 85, (
              f"Forex spring confidence {confidence.total_score} exceeds 85 cap"
          )

      # Best spring confidence also capped
      best_confidence = calculate_spring_confidence(
          history.best_spring, range.creek, []
      )
      assert best_confidence.total_score <= 85
  ```

- [ ] Test stock vs forex campaign comparison:
  ```python
  def test_stock_vs_forex_campaign_comparison():
      """
      Compare identical 3-spring campaigns across asset classes.

      Demonstrates that campaign STRUCTURE (volume trend, risk level) is
      independent of asset class, but individual spring CONFIDENCE differs.
      """
      # Create identical campaigns
      stock_history = create_and_detect_campaign("AAPL")
      forex_history = create_and_detect_campaign("EUR/USD")

      # Campaign structure identical
      assert stock_history.volume_trend == forex_history.volume_trend
      assert stock_history.risk_level == forex_history.risk_level
      assert stock_history.spring_count == forex_history.spring_count

      # But confidence scores differ (stock higher)
      stock_best_conf = calculate_spring_confidence(
          stock_history.best_spring, creek, []
      )
      forex_best_conf = calculate_spring_confidence(
          forex_history.best_spring, creek, []
      )

      assert stock_best_conf.total_score > forex_best_conf.total_score
      assert stock_best_conf.total_score <= 100
      assert forex_best_conf.total_score <= 85
  ```

- [ ] Test distribution warning campaign (RISING volume):
  ```python
  def test_forex_rising_volume_campaign_warning():
      """
      Test 3-spring campaign with RISING volume (distribution warning).

      Campaign Structure:
      - Spring 1: 0.3x volume
      - Spring 2: 0.5x volume (RISING)
      - Spring 3: 0.65x volume (RISING - warning)

      Expected:
      - Volume Trend: RISING (0.3 â†’ 0.5 â†’ 0.65)
      - Risk Level: HIGH (distribution warning)
      - This pattern should be AVOIDED by traders
      """
      symbol = "EUR/USD"
      bars = create_three_spring_campaign(
          symbol=symbol,
          volumes=[Decimal("0.3"), Decimal("0.5"), Decimal("0.65")],
          penetrations=[Decimal("0.02"), Decimal("0.025"), Decimal("0.03")],
      )

      detector = SpringDetector()
      history = detector.detect_all_springs(range, bars, WyckoffPhase.C)

      assert history.spring_count == 3
      assert history.volume_trend == "RISING", "Volume increasing (distribution)"
      assert history.risk_level == "HIGH", "Rising volume = HIGH risk"

      # Best spring is FIRST (lowest volume in RISING trend)
      assert history.best_spring.volume_ratio == Decimal("0.3")
  ```
```

**Assigned To:** Conrad (Campaign Strategist)
**Dependencies:** Story 5.6 (SpringDetector, SpringHistory, analyze_volume_trend)
**Deadline:** Before final integration testing

---

### **Amendment 5: Add Minimum Confidence Threshold Test** ðŸŸ¢ **MEDIUM PRIORITY**

**Issue:** Story 0.5 added `MINIMUM_CONFIDENCE_THRESHOLD = 70` to both detectors. Need to verify this threshold is enforced consistently across asset classes (no special treatment).

**Required Action:**

Add to **Task 7** (Confidence Score Comparison Tests):

```python
def test_minimum_confidence_threshold_enforcement():
    """
    Test that 70 minimum confidence is enforced for ALL asset classes.

    Story 0.5 AC 15: Patterns below 70 confidence should be rejected
    regardless of asset class (no special treatment for forex).
    """
    # Create marginal spring (scores ~69 confidence)
    marginal_bars = create_spring_bars(
        creek_level=Decimal("100.00"),
        penetration_pct=Decimal("0.045"),  # Deep penetration (4.5%)
        volume_ratio=Decimal("0.65"),      # High volume (near 0.7 limit)
        recovery_bars=5,                    # Slow recovery
    )

    # Test stock rejection
    stock_spring = detect_spring(
        stock_range, marginal_bars, WyckoffPhase.C, symbol="AAPL"
    )
    if stock_spring is not None:
        stock_confidence = calculate_spring_confidence(stock_spring, creek, [])
        if stock_confidence.total_score < 70:
            # Pattern detected but confidence too low
            # Downstream signal generation should reject
            logger.warning(
                "stock_below_threshold",
                confidence=stock_confidence.total_score,
                message="Stock spring detected but below 70 threshold"
            )

    # Test forex rejection
    forex_spring = detect_spring(
        forex_range, marginal_bars, WyckoffPhase.C, symbol="EUR/USD"
    )
    if forex_spring is not None:
        forex_confidence = calculate_spring_confidence(forex_spring, creek, [])
        if forex_confidence.total_score < 70:
            logger.warning(
                "forex_below_threshold",
                confidence=forex_confidence.total_score,
                message="Forex spring detected but below 70 threshold"
            )

    # Both should fail threshold (or be rejected at detection)
    # NOTE: Current implementation may reject at detection time
    # OR may detect pattern but reject at signal generation time
    # Test validates threshold is enforced somewhere in pipeline
```

**Alternative Test (if rejection happens at signal generation):**

```python
def test_signal_generation_rejects_low_confidence():
    """Test that generate_spring_signal rejects patterns <70 confidence."""
    from src.signal_generator.spring_signal_generator import generate_spring_signal

    # Create spring with 68 confidence (below threshold)
    low_conf_spring = create_spring_with_confidence(target=68)

    signal = generate_spring_signal(
        spring=low_conf_spring,
        test=test,
        range=range,
        confidence=68,  # Below 70 threshold
        phase=WyckoffPhase.C,
        account_size=Decimal("100000"),
        risk_per_trade_pct=Decimal("0.01"),
    )

    # Should return None (rejected)
    assert signal is None, "Signal generation should reject confidence <70"
```

**Assigned To:** Victoria (Pattern Quality)
**Deadline:** Before Task 7 implementation

---

### **Amendment 6: Add SOS Entry Type Tests (LPS Bonus)** ðŸŸ¢ **MEDIUM PRIORITY**

**Issue:** Story 6.5 confidence scoring includes LPS entry bonuses that differ by asset class:
- Stock LPS: Baseline 75 (vs 65 direct SOS) = +10 reduction in risk
- Forex LPS: Baseline 70 (vs 60 direct SOS) = +10 reduction in risk

Need to verify these bonuses are applied correctly.

**Required Action:**

Expand **Task 5** (Stock SOS Tests):

```python
def test_stock_sos_lps_entry_bonus():
    """
    Test LPS entry receives proper baseline adjustment for stocks.

    Story 6.5 Confidence Scoring:
    - Direct SOS entry: Baseline 65 (higher risk, 5% stop)
    - LPS entry: Baseline 75 (+10 for lower risk, 3% stop)
    """
    # Detect SOS breakout
    sos = detect_sos_breakout(range, bars, volume_analysis, phase, symbol="SPY")
    assert sos is not None
    assert sos.asset_class == "stock"

    # Calculate confidence for direct SOS entry
    direct_confidence = calculate_sos_confidence(
        sos=sos,
        ice=range.ice,
        entry_type="DIRECT",  # 5% stop, baseline 65
    )

    # Calculate confidence for LPS entry (pullback after SOS)
    lps_confidence = calculate_sos_confidence(
        sos=sos,
        ice=range.ice,
        entry_type="LPS",  # 3% stop, baseline 75
    )

    # LPS should score 10 points higher (lower risk premium)
    assert lps_confidence.total_score >= direct_confidence.total_score + 10
```

Expand **Task 6** (Forex SOS Tests):

```python
def test_forex_sos_lps_entry_bonus():
    """
    Test LPS entry receives proper baseline adjustment for forex.

    Story 6.5 Confidence Scoring:
    - Direct SOS entry: Baseline 60 (higher risk, 5% pips)
    - LPS entry: Baseline 70 (+10 for lower risk, 3% pips)

    NOTE: Forex baselines are 5 points lower than stocks due to
    tick volume reliability.
    """
    sos = detect_sos_breakout(range, bars, volume_analysis, phase, symbol="GBP/USD")
    assert sos is not None
    assert sos.asset_class == "forex"

    # Calculate confidence for both entry types
    direct_confidence = calculate_sos_confidence(
        sos=sos,
        ice=range.ice,
        entry_type="DIRECT",  # Baseline 60
    )

    lps_confidence = calculate_sos_confidence(
        sos=sos,
        ice=range.ice,
        entry_type="LPS",  # Baseline 70
    )

    # LPS should score 10 points higher
    assert lps_confidence.total_score >= direct_confidence.total_score + 10

    # Both should cap at 85 for forex
    assert direct_confidence.total_score <= 85
    assert lps_confidence.total_score <= 85
```

**Assigned To:** Rachel (Risk Management)
**Dependencies:** Story 6.5 (SOS Confidence Scoring - if not yet implemented, defer to Story 6.6)
**Deadline:** Before Task 5/6 implementation OR defer to Story 6.6 integration tests

---

## Summary of Amendments

| Amendment | Priority | Assigned To | Blocker? | Tasks Affected |
|-----------|----------|-------------|----------|----------------|
| 1. Clarify Spring Volume Weight | ðŸ”´ HIGH | Victoria + Wayne | âœ… YES | Task 2, AC 2 |
| 2. Define Perfect Pattern | ðŸŸ¡ HIGH | Victoria | âŒ No | Task 3 |
| 3. Add Position Sizing Comparison | ðŸŸ¡ HIGH | Rachel | âŒ No | Task 7 |
| 4. Multi-Spring Campaign Tests | ðŸŸ¡ HIGH | Conrad | âŒ No | NEW Task 11 |
| 5. Minimum Confidence Threshold | ðŸŸ¢ MEDIUM | Victoria | âŒ No | Task 7 |
| 6. SOS Entry Type Tests | ðŸŸ¢ MEDIUM | Rachel | âŒ No | Task 5, Task 6 |

---

## Revised Acceptance Criteria

### **NEW AC 9: Multi-Spring Campaign Validation**

- Test stock 3-spring accumulation (DECLINING volume, LOW risk)
- Test forex 3-spring accumulation (same structure, 85 confidence cap)
- Test stock vs forex campaign comparison (structure identical, confidence differs)
- Test RISING volume campaign (distribution warning, HIGH risk)
- Verify `SpringHistory.volume_trend` and `risk_level` work across asset classes

### **NEW AC 10: Minimum Confidence Threshold Enforcement**

- Test that patterns scoring <70 confidence are rejected (or don't generate signals)
- Verify threshold is consistent across asset classes (no special treatment)
- Test boundary cases (69 rejected, 70 accepted)

### **UPDATED AC 7: Enhanced Confidence Score Comparison**

- Stock max: 100 âœ… (existing)
- Forex max: 85 âœ… (existing)
- Stock volume weight: 40 points (Spring) / 35 points (SOS) â¬…ï¸ CLARIFIED
- Forex volume weight: 10 points âœ… (existing)
- **NEW:** Document position sizing implications (multipliers, account risk %)
- **NEW:** Show side-by-side comparison with risk calculations

---

## Revised Task List

### **NEW: Task 11 - Multi-Spring Campaign Tests** (AC 9)

- [ ] Stock 3-spring DECLINING volume campaign
- [ ] Forex 3-spring DECLINING volume campaign
- [ ] Stock vs forex campaign comparison
- [ ] RISING volume distribution warning campaign
- [ ] Verify SpringHistory fields work across asset classes

**Estimate:** +2 story points

### **UPDATED: Task 2 - Stock Spring Tests** (Amendment 1)

- [ ] Add component score validation test
- [ ] Verify volume weight = 40 points (or correct value from formula)
- [ ] Verify penetration weight = 35 points
- [ ] Verify recovery weight = 25 points

**Estimate:** No change (within existing scope)

### **UPDATED: Task 3 - Forex Spring Tests** (Amendment 2)

- [ ] Add perfect spring confidence cap test
- [ ] Define perfect spring fixture characteristics
- [ ] Verify 85 cap with textbook-perfect pattern

**Estimate:** +0.5 story points

### **UPDATED: Task 7 - Confidence Comparison Tests** (Amendments 3, 5)

- [ ] Add position sizing calculations
- [ ] Add confidence tier and multiplier output
- [ ] Add minimum threshold enforcement test (AC 10)
- [ ] Document risk implications in test output

**Estimate:** +1 story point

### **UPDATED: Tasks 5/6 - SOS Tests** (Amendment 6)

- [ ] Add LPS entry bonus tests (if Story 6.5 complete)
- [ ] Verify baseline differences (stock 65/75 vs forex 60/70)
- [ ] **OR DEFER** to Story 6.6 if Story 6.5 not complete

**Estimate:** +0.5 story points (or defer)

---

## Revised Story Estimate

**Original Estimate:** 5 story points
**Revised Estimate:** **9 story points** (or 8.5 if Amendment 6 deferred)

**Breakdown:**
- Original scope: 5 points
- Amendment 3 (Position sizing): +1 point
- Amendment 2 (Perfect pattern): +0.5 points
- Amendment 4 (Multi-spring campaigns): +2 points
- Amendment 6 (LPS bonuses): +0.5 points

**Justification:** The amendments add significant educational and validation value but require additional test fixture creation and documentation.

---

## Implementation Priority

### **Phase 1: Blockers (Week 3, Day 1)**

1. **Amendment 1:** Clarify Spring volume weight (Victoria + Wayne)
   - Review Story 5.4 formula
   - Update AC 2 and Task 2
   - Estimated time: 2 hours

### **Phase 2: Core Integration Tests (Week 3, Days 2-3)**

2. **Original AC 2-6:** Stock, forex, CFD end-to-end tests
3. **Amendment 2:** Perfect pattern tests
4. **Amendment 5:** Minimum threshold tests

### **Phase 3: Risk Integration (Week 3, Day 4)**

5. **Amendment 3:** Position sizing comparison tests
6. **Amendment 6:** LPS entry bonus tests (if Story 6.5 complete)

### **Phase 4: Campaign Integration (Week 3, Day 5)**

7. **Amendment 4:** Multi-spring campaign tests (Task 11)

### **Phase 5: Performance & Documentation (Week 3, End)**

8. **Original AC 8:** Performance benchmarks
9. **Task 10:** Documentation and test report

---

## Risk Assessment

### **Risk 1: Story 6.5 Dependency (Amendment 6)** ðŸŸ¡ MEDIUM

- **Issue:** Amendment 6 depends on Story 6.5 (SOS Confidence Scoring)
- **Mitigation:** Make Amendment 6 OPTIONAL - defer to Story 6.6 if needed
- **Impact:** -0.5 story points if deferred

### **Risk 2: Volume Weight Clarification (Amendment 1)** ðŸ”´ HIGH

- **Issue:** Blocker - must resolve before Task 2 starts
- **Mitigation:** Priority review meeting with Victoria + Wayne (2 hours max)
- **Impact:** Could delay story start by 1 day if not resolved quickly

### **Risk 3: Test Data Fixtures (Amendment 4)** ðŸŸ¡ MEDIUM

- **Issue:** Multi-spring campaigns require complex test fixtures
- **Mitigation:** Reuse existing `create_spring_bars()` helper with loop
- **Impact:** +1 hour fixture creation time

---

## Team Sign-Off

**Reviewed By:**

- âœ… **William (Wyckoff Education):** Educational value ++, amendments critical for trader understanding
- âœ… **Wayne (Volume Analysis):** Amendment 1 is BLOCKER, rest approved
- âœ… **Victoria (Pattern Quality):** Amendments 2 and 5 essential for quality validation
- âœ… **Rachel (Risk Management):** Amendments 3 and 6 show real-world position sizing impact
- âœ… **Conrad (Campaign Strategist):** Amendment 4 validates Story 5.6 integration across assets

**Recommendation to Bob (Scrum Master):** âœ… **APPROVE Story 0.6 with 9-point estimate**

---

## Next Steps for Bob

1. **Schedule Volume Weight Review Meeting** (Amendment 1 blocker)
   - Attendees: Victoria, Wayne, implementer
   - Duration: 2 hours max
   - Deliverable: Confirmed Spring component weights

2. **Update Story 0.6 Document**
   - Add AC 9 (Multi-spring campaigns)
   - Add AC 10 (Minimum threshold)
   - Update AC 7 (Position sizing)
   - Add Task 11
   - Update estimates to 9 points

3. **Review Dependencies**
   - Story 6.5 status (for Amendment 6)
   - Story 5.6 completion (for Amendment 4)

4. **Adjust Sprint Plan**
   - Original: 5 points (Week 3, Days 1-3)
   - Revised: 9 points (Week 3, entire week)
   - May push other Week 3 stories to Week 4

---

## Document Approval

**Prepared By:** William (Wyckoff Education Specialist)
**Date:** 2025-11-15
**Status:** âœ… FINAL - Ready for Bob's Review
**Next Review:** After Bob updates Story 0.6 document

---

**Questions for Bob:**

1. Do you want to keep Amendment 6 (LPS bonuses) or defer to Story 6.6?
2. Can you schedule the Volume Weight Review meeting for tomorrow morning?
3. Does the 9-point estimate fit in Week 3 sprint capacity?
