# Volume Analysis Guide - Wyckoff Trading System

## Table of Contents

1. [Volume Fundamentals (Wyckoff's Laws)](#1-volume-fundamentals)
2. [Volume in Each Phase](#2-volume-in-each-phase)
3. [Pattern-Specific Volume Requirements](#3-pattern-specific-volume-requirements)
4. [Volume Profile Interpretation](#4-volume-profile-interpretation)
5. [Effort vs. Result Analysis](#5-effort-vs-result-analysis)
6. [Common Volume Mistakes](#6-common-volume-mistakes)
7. [Real-World Examples](#7-real-world-examples)
8. [Troubleshooting](#8-troubleshooting)

---

## 1. Volume Fundamentals

### Wyckoff's Three Laws

Richard D. Wyckoff identified three fundamental laws governing market behavior:

1. **Law of Supply and Demand**: Price rises when demand exceeds supply, falls when supply exceeds demand
2. **Law of Effort vs. Result**: Volume (effort) should correlate with price movement (result)
3. **Law of Cause and Effect**: Volume buildup (cause) precedes price movement (effect) - **"Volume Precedes Price"**

### Volume's Role in Trading

Volume is the most reliable indicator of professional activity in the market:

- **Confirms Professional Activity**: Institutions cannot hide their footprint in volume
- **Validates Pattern Strength**: High-quality patterns have correct volume characteristics
- **Reveals Market Dynamics**: Distinguishes between absorption (bullish) and distribution (bearish)

**Key Principle**: Retail traders focus on price. Professional traders watch volume first.

---

## 2. Volume in Each Phase

Wyckoff identified distinct volume characteristics for each market phase:

| Phase | Typical Volume | Meaning | What Professionals Are Doing |
|-------|---------------|---------|------------------------------|
| **Phase A** | Very High (SC) | Panic selling exhaustion | Absorbing panic supply |
| **Phase B** | Declining | Supply absorption in progress | Quietly accumulating |
| **Phase C** | Low (Spring) | Final shakeout, minimal supply | Testing for remaining supply |
| **Phase D** | Increasing (SOS) | Demand entering decisively | Marking up positions |
| **Phase E** | Moderate-High | Markup continuation | Distributing to public |

### Phase-Specific Volume Patterns

**Phase A - Preliminary Support (PS) and Selling Climax (SC)**
- Extremely high volume on down moves
- Indicates capitulation selling
- Professionals begin absorbing

**Phase B - Building Cause**
- Volume gradually declines on rallies
- Lower volume on tests (Secondary Tests)
- Sign of successful absorption

**Phase C - Spring Test**
- **CRITICAL**: Volume MUST be low (< 0.7x average)
- Low volume confirms no new supply
- Validates that absorption is complete

**Phase D - Sign of Strength (SOS)**
- **CRITICAL**: Volume MUST be high (> 1.5x average)
- High volume confirms professional buying
- Breakout must be decisive

**Phase E - Last Point of Support (LPS)**
- Moderate to low volume on pullbacks
- Confirms support holding
- Volume should be lower than SOS

---

## 3. Pattern-Specific Volume Requirements

Each Wyckoff pattern has specific volume requirements that MUST be met for pattern validity.

### Spring Pattern

**Volume Requirement**: < 0.7x average (LOW)

**Why Low Volume?**
- Indicates all weak holders have been shaken out
- No new supply entering the market
- Professional operators have absorbed all available supply

**Volume Interpretation**:

| Volume Ratio | Quality | Interpretation |
|-------------|---------|----------------|
| 0.1-0.3x avg | IDEAL | Excellent absorption, very bullish |
| 0.3-0.5x avg | EXCELLENT | Strong absorption, high probability |
| 0.5-0.7x avg | GOOD | Valid Spring, acceptable |
| 0.7-1.0x avg | MARGINAL | Weak Spring, increased risk |
| > 1.0x avg | INVALID | Failed Spring, new supply present |

**Spring Volume Example**:
```
Spring detected at $98.50
Volume: 500,000 shares
Average Volume: 1,200,000 shares
Volume Ratio: 0.42x (500k / 1,200k)
Verdict: EXCELLENT - Strong professional absorption
```

---

### Automatic Rally (AR) Pattern

**Volume Requirement**: 0.8-1.2x average (MODERATE)

**Why Moderate Volume?**
- Confirms bounce after Spring
- Shows professional support but not panic buying
- Validates absorption process

**Volume Interpretation**:

| Volume Ratio | Quality | Interpretation |
|-------------|---------|----------------|
| 0.8-1.0x avg | EXCELLENT | Clean bounce, professional support |
| 1.0-1.2x avg | GOOD | Valid AR, some retail participation |
| < 0.8x avg | WEAK | Insufficient demand |
| > 1.2x avg | CAUTION | May indicate distribution |

**AR Quality Scoring**:
- Quick reversal (< 3 bars after Spring): +0.30
- Moderate reversal (< 5 bars): +0.15
- Volume in range: +0.30
- Clean support test: +0.20

---

### SOS (Sign of Strength) Breakout

**Volume Requirement**: > 1.5x average (HIGH)

**Why High Volume?**
- Confirms professional demand entering
- Validates breakout strength
- Shows institutions aggressively buying

**Volume Interpretation**:

| Volume Ratio | Quality | Interpretation |
|-------------|---------|----------------|
| > 2.5x avg | EXCELLENT | Explosive breakout, very high probability |
| 2.0-2.5x avg | EXCELLENT | Strong professional buying |
| 1.5-2.0x avg | GOOD | Valid SOS, sufficient demand |
| 1.2-1.5x avg | MARGINAL | Weak breakout, watch for failure |
| < 1.2x avg | INVALID | Insufficient buying, likely failure |

**SOS Volume Example**:
```
SOS breakout at $102.50
Volume: 2,800,000 shares
Average Volume: 1,200,000 shares
Volume Ratio: 2.33x (2,800k / 1,200k)
Verdict: EXCELLENT - Strong institutional demand
```

---

### LPS (Last Point of Support) Pattern

**Volume Requirement**: < 1.0x average (LOW to MODERATE)

**Why Lower Volume?**
- Confirms support holding with minimal selling
- Shows reduced supply at higher prices
- Validates strength of Ice level (broken resistance)

**Volume Interpretation**:

| Volume Ratio | Quality | Interpretation |
|-------------|---------|----------------|
| 0.3-0.6x avg | EXCELLENT | Very strong support, minimal supply |
| 0.6-0.8x avg | GOOD | Valid LPS, support confirmed |
| 0.8-1.0x avg | ACCEPTABLE | Marginal, monitor closely |
| > 1.0x avg | WEAK | Too much supply, may fail |

---

## 4. Volume Profile Interpretation

Volume profile analysis tracks volume trends across a campaign to identify professional behavior.

### DECLINING Volume Profile (Bullish in Accumulation)

**Characteristics**:
- Each successive rally has lower volume than the previous
- Volume contracts as price moves higher within range
- Each test of support shows decreasing volume

**Meaning**: Professional operators are absorbing supply quietly. They don't want to drive prices up yet - they're accumulating positions at favorable levels.

**What to Look For**:
```
Pattern 1: Spring - Volume 0.5x average
Pattern 2: AR    - Volume 0.9x average
Pattern 3: SOS   - Volume 1.8x average  ✓ DECLINING until SOS
```

**Trading Implication**: **BULLISH** - Accumulation in progress, high probability of markup

---

### INCREASING Volume Profile (Bearish Warning)

**Characteristics**:
- Volume expands on rallies within the range
- Each test shows higher volume than previous
- Climbing volume without price progress

**Meaning**: Potential distribution. Professionals may be selling into retail buying. Effort (volume) without result (price gain) signals supply overwhelming demand.

**What to Look For**:
```
Pattern 1: Spring - Volume 0.5x average
Pattern 2: Test  - Volume 1.1x average
Pattern 3: Test  - Volume 1.4x average  ✗ INCREASING volume
```

**Trading Implication**: **BEARISH WARNING** - Consider reducing exposure, potential top forming

---

### NEUTRAL Volume Profile

**Characteristics**:
- Mixed volume patterns
- No clear trending direction
- Typically occurs in early Phase B

**Meaning**: Market is in balance. Neither accumulation nor distribution is dominant.

**Trading Implication**: **WAIT** - Need more data before taking position

---

### UNKNOWN Volume Profile

**Characteristics**:
- Fewer than 3 patterns detected
- Insufficient data for classification

**Trading Implication**: **WAIT** - Need more patterns to establish trend

---

## 5. Effort vs. Result Analysis

Wyckoff's Second Law states that effort (volume) should produce a commensurate result (price movement).

### Harmony: Normal Relationship

**High Volume → Large Price Movement**
- Expected behavior in trending markets
- Confirms price action validity
- No divergence detected

**Example**:
```
SOS Breakout:
Volume: 2.5x average (HIGH EFFORT)
Price Move: +4.5% (LARGE RESULT)
Verdict: HARMONY ✓ - Valid breakout
```

---

### Divergence: Absorption or Distribution

**High Volume → Small Price Movement**
- Signals institutional activity
- Can be bullish (absorption) or bearish (distribution)
- Context determines interpretation

#### Bullish Divergence (Absorption at Spring)

**Scenario**: High volume Spring with small price movement

**Interpretation**: Professionals absorbing all available supply. Weak holders selling into professional buying.

**Example**:
```
Spring Pattern:
Volume: 0.6x average (HIGH for Spring threshold)
Price Move: -1.2% (SMALL RESULT)
Verdict: DIVERGENCE ✓ - Absorption (BULLISH)
```

**Trading Action**: **BUY** - Absorption complete, markup likely

---

#### Bearish Divergence (Distribution at Top)

**Scenario**: High volume rally with small price gain

**Interpretation**: Professionals distributing into retail demand. Supply overwhelming demand despite strong buying.

**Example**:
```
Rally Pattern:
Volume: 2.2x average (HIGH EFFORT)
Price Move: +0.8% (SMALL RESULT)
Verdict: DIVERGENCE ✗ - Distribution (BEARISH)
```

**Trading Action**: **SELL/AVOID** - Distribution detected, potential reversal

---

## 6. Common Volume Mistakes

### ❌ Mistake #1: Trading High-Volume Springs

**The Error**:
```
Spring detected at $95.00
Volume: 1.2x average  ⚠️ TOO HIGH
Result: Spring fails, price continues down to $90
```

**Why It Failed**: High volume at Spring indicates new supply entering, not absorption. Professional operators have NOT absorbed all supply.

**The Fix**:
- **REQUIRE** volume < 0.7x average for Spring validity
- Reject Springs with volume > 0.7x no matter how attractive the setup
- Wait for proper low-volume Spring

**Correct Approach**:
```
Spring detected at $95.00
Volume: 0.45x average  ✓ LOW
Result: Valid Spring, rally to $105
```

---

### ❌ Mistake #2: Accepting Low-Volume SOS Breakouts

**The Error**:
```
SOS breakout at $102.50
Volume: 0.9x average  ⚠️ TOO LOW
Result: Breakout fails, returns to range at $98
```

**Why It Failed**: Insufficient professional buying. Retail-driven breakouts without institutional support fail quickly.

**The Fix**:
- **REQUIRE** volume > 1.5x average for SOS validity
- Low-volume breakouts are likely false breakouts
- Wait for decisive institutional buying

**Correct Approach**:
```
SOS breakout at $102.50
Volume: 2.1x average  ✓ HIGH
Result: Valid breakout, continues to $110
```

---

### ❌ Mistake #3: Ignoring Volume Divergences

**The Error**:
```
Campaign shows INCREASING volume profile:
Pattern 1: 0.6x average
Pattern 2: 1.2x average
Pattern 3: 1.5x average
Trader enters position anyway
Result: Distribution, loses money
```

**Why It Failed**: INCREASING volume on rallies within range signals distribution, not accumulation.

**The Fix**:
- Monitor volume_profile field in campaigns
- Favor campaigns with DECLINING volume profiles
- Exit if volume profile changes from DECLINING to INCREASING

**Correct Approach**:
```
Campaign shows DECLINING volume profile:
Pattern 1: 0.9x average
Pattern 2: 0.7x average
Pattern 3 (SOS): 2.0x average  ✓ DECLINING until breakout
Result: Successful markup phase
```

---

### ❌ Mistake #4: Misinterpreting Intraday Volume Spikes

**The Error**:
```
15-minute chart Spring at market open:
Volume: 3.5x average  ⚠️ MISLEADING
Reason: Market open always has high volume
Result: False signal, not a valid Spring
```

**Why It Failed**: Session open/close volume is naturally elevated. Raw volume comparison is misleading.

**The Fix**:
- Use session-relative volume averages for intraday timeframes
- Apply timeframe-specific volume thresholds
- Account for natural volume patterns (open > mid-day > close)

**Correct Approach**:
```
15-minute chart Spring mid-session:
Volume: 0.5x average (session-adjusted)  ✓ VALID
Result: True Spring signal
```

---

## 7. Real-World Examples

### Example 1: Perfect Volume Alignment - SPY Accumulation

**Context**: Daily chart, 3-month accumulation range

**Campaign Progression**:

```
Day 1 - Selling Climax (SC):
  Price: $380 → $372 (-2.1%)
  Volume: 2.8x average
  Interpretation: Panic selling, professionals start absorbing

Day 15 - Spring:
  Price: $370 (new low)
  Volume: 0.42x average ✓ LOW
  Quality: EXCELLENT
  Interpretation: Final shakeout, absorption complete

Day 18 - Automatic Rally (AR):
  Price: $370 → $378 (+2.2%)
  Volume: 0.95x average ✓ MODERATE
  Quality_Score: 0.78 (quick reversal, 3 bars)
  Interpretation: Professional support confirmed

Day 35 - SOS Breakout:
  Price: $382 (break above $380 resistance)
  Volume: 2.15x average ✓ HIGH
  Quality: EXCELLENT
  Interpretation: Institutions aggressively buying

Day 42 - LPS:
  Price: $380 (pullback to prior resistance)
  Volume: 0.68x average ✓ LOW
  Interpretation: Support holding, ready for markup

Result: Price rallied to $415 (+9%) over next 30 days
```

**Volume Profile**: DECLINING throughout accumulation (bullish)
**Effort vs. Result**: HARMONY at all patterns
**Absorption Quality**: 0.92 (excellent)

**Key Success Factors**:
1. Spring had extremely low volume (0.42x)
2. SOS had strong institutional volume (2.15x)
3. Volume profile was DECLINING (professional accumulation)
4. No volume divergences detected

---

### Example 2: Volume Divergence Warning - AAPL Distribution

**Context**: Daily chart, attempted breakout fails

**Campaign Progression**:

```
Day 1 - Spring (Initial):
  Price: $170
  Volume: 0.55x average ✓ LOW
  Quality: GOOD
  Interpretation: Looks valid initially

Day 8 - Test #1:
  Price: $172 (+1.2%)
  Volume: 1.1x average ⚠️ ELEVATED
  Interpretation: More volume than Spring (concerning)

Day 15 - Test #2:
  Price: $173 (+0.6%)
  Volume: 1.4x average ⚠️ INCREASING
  Interpretation: Effort vs. Result DIVERGENCE

Day 20 - Attempted SOS:
  Price: $175 (breakout attempt)
  Volume: 1.3x average ✗ TOO LOW for SOS
  Quality: POOR
  Interpretation: Weak breakout, insufficient demand

Result: Failed breakout, returned to $168 (-4%)
```

**Volume Profile**: INCREASING (bearish warning)
**Effort vs. Result**: DIVERGENCE detected at Day 15
**Warning Signs Ignored**:
1. Volume increased on each test (distribution)
2. Price gained only 0.6% despite 1.4x volume (divergence)
3. SOS volume was insufficient (1.3x vs. required 1.5x+)

**Lesson**: INCREASING volume profile is a red flag. Exit when divergence detected.

---

### Example 3: Intraday Volume Spike Handling - ES 15m

**Context**: E-mini S&P 500 futures, 15-minute chart

**Scenario**: Market open volume spike

```
9:30 AM - Market Open Spring:
  Price: 4,580
  Raw Volume: 45,000 contracts
  Raw Average: 12,000 contracts
  Raw Ratio: 3.75x ⚠️ MISLEADING (market open)

Session-Adjusted Analysis:
  Session Average (9:30-10:00): 38,000 contracts
  Session-Relative Ratio: 1.18x
  Verdict: ✗ INVALID - Too high even session-adjusted

Result: Not a valid Spring, avoided false signal
```

**Correct Spring Later**:

```
11:15 AM - Mid-Session Spring:
  Price: 4,575
  Raw Volume: 8,000 contracts
  Session-Average Volume: 12,000 contracts
  Session-Relative Ratio: 0.67x ✓ LOW
  Verdict: ✓ VALID Spring

Result: Valid signal, rallied to 4,595 (+0.44%)
```

**Key Lesson**: Always use session-relative volume for intraday timeframes. Market open/close volume is naturally elevated and can generate false signals.

---

## 8. Troubleshooting

### Issue: Campaign rejected due to volume profile

**Symptom**: `add_pattern()` returns `None`, logs show "Portfolio limits exceeded"

**Possible Causes**:
1. Too many active campaigns (> `max_concurrent_campaigns`)
2. Portfolio heat exceeds limit (> `max_portfolio_heat_pct`)
3. INCREASING volume profile triggered risk reduction

**Solution**:
```python
# Check active campaigns
active = detector.get_active_campaigns()
print(f"Active campaigns: {len(active)}/{detector.max_concurrent_campaigns}")

# Check volume profiles
for campaign in active:
    print(f"Campaign {campaign.campaign_id}: {campaign.volume_profile.value}")
    if campaign.volume_profile == VolumeProfile.INCREASING:
        print("  ⚠️ Distribution warning - consider exiting")
```

---

### Issue: Effort vs. Result shows DIVERGENCE

**Symptom**: `campaign.effort_vs_result == EffortVsResult.DIVERGENCE`

**Interpretation Depends on Context**:

**If at Spring**: BULLISH (absorption)
```python
if isinstance(pattern, Spring) and campaign.effort_vs_result == EffortVsResult.DIVERGENCE:
    print("✓ Bullish divergence - absorption at Spring")
    # This is GOOD - proceed with trade
```

**If at Rally/Breakout**: BEARISH (distribution)
```python
if isinstance(pattern, SOSBreakout) and campaign.effort_vs_result == EffortVsResult.DIVERGENCE:
    print("✗ Bearish divergence - potential distribution")
    # This is BAD - consider exiting
```

---

### Issue: Low absorption_quality score

**Symptom**: `campaign.absorption_quality < 0.5`

**Causes**:
1. Spring volume too high (> 0.7x average)
2. No AR pattern detected after Spring
3. Slow reversal (> 5 bars to AR)

**Solution**:
```python
if campaign.absorption_quality < 0.5:
    print(f"Low absorption quality: {campaign.absorption_quality:.2f}")

    # Check Spring volume
    spring = next(p for p in campaign.patterns if isinstance(p, Spring))
    if spring.volume_ratio > 0.7:
        print("  Issue: Spring volume too high")
        # Solution: Wait for better Spring

    # Check for AR
    has_ar = any(isinstance(p, AutomaticRally) for p in campaign.patterns)
    if not has_ar:
        print("  Issue: No AR detected yet")
        # Solution: Wait for AR confirmation
```

---

### Issue: Climax detected unexpectedly

**Symptom**: `campaign.climax_detected == True`, logs show climax warning

**Interpretation**:
- **Selling Climax (SC)**: Bullish if at Phase A (panic selling exhaustion)
- **Buying Climax (BC)**: Bearish if at Phase E (euphoric buying, potential top)

**Action**:
```python
if campaign.climax_detected:
    if campaign.current_phase == WyckoffPhase.A:
        print("✓ Selling climax - potential accumulation opportunity")
    elif campaign.current_phase == WyckoffPhase.E:
        print("✗ Buying climax - potential distribution, consider exiting")
```

---

## Quick Reference

### Volume Requirements by Pattern

| Pattern | Volume Requirement | Threshold |
|---------|-------------------|-----------|
| Spring | LOW | < 0.7x average |
| AR | MODERATE | 0.8-1.2x average |
| SOS | HIGH | > 1.5x average |
| LPS | LOW-MODERATE | < 1.0x average |

### Volume Profile Signals

| Profile | Meaning | Action |
|---------|---------|--------|
| DECLINING | Accumulation (bullish) | Enter/Hold |
| INCREASING | Distribution (bearish) | Exit/Avoid |
| NEUTRAL | Balanced | Wait |
| UNKNOWN | Insufficient data | Wait |

### Effort vs. Result Interpretation

| Pattern Type | High Effort + Small Result | Interpretation |
|-------------|---------------------------|----------------|
| Spring | DIVERGENCE | **BULLISH** - Absorption |
| Rally/SOS | DIVERGENCE | **BEARISH** - Distribution |
| Normal | HARMONY | Normal behavior |

---

## Additional Resources

- **API Documentation**: See `docs/api/campaign-detector-api.md` for IntradayCampaignDetector usage
- **Wyckoff Methodology**: `docs/wyckoff-requirements/` for pattern specifications
- **Code Examples**: `docs/examples/` for integration patterns
- **Testing Data**: `shared/fixtures/` for labeled pattern datasets

---

**Last Updated**: 2026-01-17
**Version**: 1.0
**Story**: STORY-14.6 - Volume Analysis Guide & API Documentation
