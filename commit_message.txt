Story 9.6: Campaign Performance Tracking - Full-Stack Implementation

Implements comprehensive performance analytics for completed trading campaigns
with backend REST API, database persistence, and Vue.js frontend visualization.

## Backend Implementation (Tasks 1-8)

### Core Features
- **CampaignMetrics Data Model**: Comprehensive metrics model with campaign-level
  aggregates (return %, R-multiple, win rate, drawdown) and position-level details
- **Performance Calculator Service**: Calculates all metrics from closed positions
  with phase-specific analysis (Phase C vs Phase D performance comparison)
- **P&L Curve Generation**: Time-series cumulative P&L data for equity curve charts
- **Aggregated Performance**: Multi-campaign statistics with filtering (symbol,
  timeframe, date range, min return, min R)
- **Database Schema**: campaign_metrics table with optimized indexes for queries
- **REST API Endpoints**: 3 endpoints with comprehensive error handling

### API Endpoints
- GET /api/v1/campaigns/{campaign_id}/performance - Campaign metrics
- GET /api/v1/campaigns/{campaign_id}/pnl-curve - P&L curve visualization data
- GET /api/v1/campaigns/performance/aggregated - Aggregated statistics with filters

### Data Models
- CampaignMetrics: Campaign-level metrics with phase-specific breakdown
- PositionMetrics: Individual position performance (R-multiple, win/loss status)
- PnLCurve: Time-series P&L data with drawdown tracking
- AggregatedMetrics: Cross-campaign statistics (overall win rate, avg return, best/worst)
- MetricsFilter: Query filtering for aggregated metrics

### Key Calculations
- **R-Multiple**: (exit_price - entry_price) / (entry_price - stop_loss)
- **Win Rate**: (winning_positions / total_positions) Ã— 100
- **Max Drawdown**: Maximum peak-to-trough decline during campaign
- **Target Achievement**: (actual_high_reached / expected_jump_target) Ã— 100
- **Phase-Specific R**: Separate average R for Phase C (SPRING/LPS) vs Phase D (SOS)

### Database
- New table: campaign_metrics with NUMERIC(18,8) precision for financial data
- Indexes: campaign_id (unique), symbol, total_return_pct, total_r_achieved
- UTC timezone enforcement on all datetime fields
- Alembic migration: 012_add_campaign_metrics_table.py

### Testing
- **Unit Tests**: 15 tests covering all calculation logic (100% coverage)
- **Integration Tests**: 8 tests with real async database

## Frontend Implementation (Tasks 9-12)

### TypeScript Interfaces
- **campaign-performance.ts** (262 lines): Complete interfaces matching backend
- **decimal-utils.ts** (378 lines): Big.js utilities (22 functions)
- **index.ts**: Centralized type exports

### Decimal Precision
- Big.js library (^7.0.1) for arbitrary-precision decimal arithmetic
- All financial values as strings to match backend NUMERIC(18,8)
- Configured to 8 decimal places with roundHalfUp rounding mode

### Pinia Store
- **campaignStore.ts** (370 lines): Complete state management
- State: campaignMetrics, pnlCurves, aggregatedMetrics, loading/error states
- Actions: fetchCampaignPerformance, fetchPnLCurve, fetchAggregatedPerformance
- Getters: 17 getters for computed values

### Vue Components

#### CampaignPerformance.vue (711 lines)
- Campaign Summary Card with key metrics
- Position Details DataTable (sortable/filterable)
- P&L Curve Chart with Lightweight Charts

#### PerformanceDashboard.vue (752 lines)
- Filters Panel (symbol, timeframe, date range, min return/R)
- Statistics Cards (aggregated metrics)
- Best/Worst Campaigns Table with CSV export
- All Campaigns Table (sortable, paginated)

## Data Validation & Quality

### CLOSED Position Validation
- Location: backend/src/models/position.py:285-321
- Ensures CLOSED positions have exit_price, closed_date, realized_pnl

### UTC Timezone Enforcement
- Campaign Model: backend/src/models/campaign_lifecycle.py:286-296
- Position Model: backend/src/models/position.py:189-224
- Rejects naive datetimes

### Risk Limit Warning
- Location: backend/src/services/campaign_performance_calculator.py:282-299
- Logs warning when campaign exceeds 5% risk limit (FR18)

## Code Quality

### Static Analysis
- mypy --strict: PASSED (0 issues)
- ruff check: PASSED (0 issues)

### Test Coverage
- Unit tests: 15 tests PASSED
- Integration tests: 8 tests PASSED

## Files Changed

### Backend
- backend/src/models/campaign.py (671 lines added)
- backend/src/services/campaign_performance_calculator.py (479 lines new)
- backend/src/api/routes/campaigns.py (559 lines added)
- backend/src/repositories/models.py (modified)
- backend/src/repositories/campaign_repository.py (modified)
- backend/alembic/versions/012_add_campaign_metrics_table.py (new)
- backend/tests/unit/test_campaign_performance.py (549 lines new)
- backend/tests/integration/test_campaign_performance_integration.py (285 lines new)

### Frontend
- frontend/src/types/campaign-performance.ts (262 lines new)
- frontend/src/types/decimal-utils.ts (378 lines new)
- frontend/src/types/index.ts (37 lines new)
- frontend/src/stores/campaignStore.ts (370 lines new)
- frontend/src/components/CampaignPerformance.vue (711 lines new)
- frontend/src/components/PerformanceDashboard.vue (752 lines new)
- frontend/package.json (modified - added big.js)

## Acceptance Criteria (11/11 Complete)

1. âœ… Campaign metrics: total_return_pct, total_r_achieved, duration_days, max_drawdown
2. âœ… Position-level metrics: individual R, win/loss status
3. âœ… Comparison: actual vs expected (Jump target)
4. âœ… Function: calculate_campaign_performance(campaign) â†’ CampaignMetrics
5. âœ… Historical tracking: campaign_metrics table
6. âœ… Aggregation: average return, win rate across campaigns
7. âœ… Unit test: 15 tests with synthetic campaigns
8. âœ… Integration test: 8 tests with real database
9. âœ… Visualization: P&L curve with Lightweight Charts
10. âœ… API: GET /api/campaigns/performance/aggregated
11. âœ… Phase-specific metrics: Phase C vs Phase D performance

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
