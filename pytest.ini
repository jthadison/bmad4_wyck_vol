# pytest.ini - Optimized for memory efficiency
# Place this file in: e:\projects\claude_code\bmad4_wyck_vol\pytest.ini

[pytest]
# =============================================================================
# TEST DISCOVERY - Critical for memory management
# =============================================================================
# Only scan the main tests directory by default
testpaths = backend/tests

# Prevent pytest from scanning these directories (HUGE memory savings)
norecursedirs =
    .*
    __pycache__
    node_modules
    venv
    .venv
    env
    .env
    build
    dist
    *.egg-info
    .git
    .tox
    .nox
    htmlcov
    .pytest_cache
    frontend
    docs
    data
    logs
    migrations

# Don't collect files matching these patterns
python_files = test_*.py *_test.py
python_classes = Test[A-Z]* *Tests
python_functions = test_*

# Ignore benchmarks and integration tests for fast runs
# Remove specific ignores when you want to run them explicitly
addopts =
    --ignore=backend/benchmarks
    --ignore=backend/src
    -p no:benchmark
    -p no:cov
    --tb=short
    -q

# =============================================================================
# ASYNC CONFIGURATION
# =============================================================================
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# =============================================================================
# CUSTOM MARKERS - Register to avoid warnings
# =============================================================================
markers =
    performance: marks tests as performance tests (deselect with '-m "not performance"')
    timeout: marks test with timeout value
    slow: marks tests as slow (deselect with '-m "not slow"')
    integration: marks tests as integration tests
    unit: marks tests as unit tests
    benchmark: marks tests as benchmark tests
    database: marks tests requiring database connection
    network: marks tests requiring network access

# =============================================================================
# OUTPUT & REPORTING
# =============================================================================
console_output_style = progress
verbosity_assertions = 2

# Fail fast on first error (remove for CI)
# addopts = -x

# =============================================================================
# WARNINGS FILTER - Reduce noise
# =============================================================================
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::PydanticDeprecatedSince20
    ignore::pytest.PytestUnknownMarkWarning

# =============================================================================
# TIMEOUT (if pytest-timeout is installed)
# =============================================================================
timeout = 300
timeout_method = thread

# =============================================================================
# COVERAGE (only when explicitly enabled with --cov)
# =============================================================================
# Run coverage with: python -m pytest --cov=backend/src --cov-report=html
